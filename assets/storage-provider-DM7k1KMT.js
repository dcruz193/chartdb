import{g as ua,i as Ir,k as sa,j as ca}from"./index-D22tuFcn.js";import{s as Pr,z as ie,a as Or,b as la}from"./use-storage-CGFXC_qQ.js";var Er={exports:{}};(function(H,C){(function(ne,j){H.exports=j()})(Ir,function(){var ne=function(e,n){return(ne=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])})(e,n)},j=function(){return(j=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var a in n=arguments[t])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e}).apply(this,arguments)};function oe(e,n,t){for(var r,a=0,i=n.length;a<i;a++)!r&&a in n||((r=r||Array.prototype.slice.call(n,0,a))[a]=n[a]);return e.concat(r||Array.prototype.slice.call(n))}var Q=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Ir,U=Object.keys,z=Array.isArray;function J(e,n){return typeof n!="object"||U(n).forEach(function(t){e[t]=n[t]}),e}typeof Promise>"u"||Q.Promise||(Q.Promise=Promise);var he=Object.getPrototypeOf,an={}.hasOwnProperty;function L(e,n){return an.call(e,n)}function pe(e,n){typeof n=="function"&&(n=n(he(e))),(typeof Reflect>"u"?U:Reflect.ownKeys)(n).forEach(function(t){ye(e,t,n[t])})}var xn=Object.defineProperty;function ye(e,n,t,r){xn(e,n,J(t&&L(t,"get")&&typeof t.get=="function"?{get:t.get,set:t.set,configurable:!0}:{value:t,configurable:!0,writable:!0},r))}function me(e){return{from:function(n){return e.prototype=Object.create(n.prototype),ye(e.prototype,"constructor",e),{extend:pe.bind(null,e.prototype)}}}}var kn=Object.getOwnPropertyDescriptor,tt=[].slice;function $e(e,n,t){return tt.call(e,n,t)}function In(e,n){return n(e)}function De(e){if(!e)throw new Error("Assertion Failed")}function Qe(e){Q.setImmediate?setImmediate(e):setTimeout(e,0)}function fe(e,n){if(typeof n=="string"&&L(e,n))return e[n];if(!n)return e;if(typeof n!="string"){for(var t=[],r=0,a=n.length;r<a;++r){var i=fe(e,n[r]);t.push(i)}return t}var o=n.indexOf(".");if(o!==-1){var u=e[n.substr(0,o)];return u==null?void 0:fe(u,n.substr(o+1))}}function ue(e,n,t){if(e&&n!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof n!="string"&&"length"in n){De(typeof t!="string"&&"length"in t);for(var r=0,a=n.length;r<a;++r)ue(e,n[r],t[r])}else{var i,o,u=n.indexOf(".");u!==-1?(i=n.substr(0,u),(o=n.substr(u+1))===""?t===void 0?z(e)&&!isNaN(parseInt(i))?e.splice(i,1):delete e[i]:e[i]=t:ue(u=!(u=e[i])||!L(e,i)?e[i]={}:u,o,t)):t===void 0?z(e)&&!isNaN(parseInt(n))?e.splice(n,1):delete e[n]:e[n]=t}}function Pn(e){var n,t={};for(n in e)L(e,n)&&(t[n]=e[n]);return t}var rt=[].concat;function Ge(e){return rt.apply([],e)}var Be="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Ge([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(n){return n+e+"Array"})}))).filter(function(e){return Q[e]}),On=new Set(Be.map(function(e){return Q[e]})),Ie=null;function _e(e){return Ie=new WeakMap,e=function n(t){if(!t||typeof t!="object")return t;var r=Ie.get(t);if(r)return r;if(z(t)){r=[],Ie.set(t,r);for(var a=0,i=t.length;a<i;++a)r.push(n(t[a]))}else if(On.has(t.constructor))r=t;else{var o,u=he(t);for(o in r=u===Object.prototype?{}:Object.create(u),Ie.set(t,r),t)L(t,o)&&(r[o]=n(t[o]))}return r}(e),Ie=null,e}var at={}.toString;function on(e){return at.call(e).slice(8,-1)}var je=typeof Symbol<"u"?Symbol.iterator:"@@iterator",it=typeof je=="symbol"?function(e){var n;return e!=null&&(n=e[je])&&n.apply(e)}:function(){return null};function _(e,n){return n=e.indexOf(n),0<=n&&e.splice(n,1),0<=n}var P={};function q(e){var n,t,r,a;if(arguments.length===1){if(z(e))return e.slice();if(this===P&&typeof e=="string")return[e];if(a=it(e)){for(t=[];!(r=a.next()).done;)t.push(r.value);return t}if(e==null)return[e];if(typeof(n=e.length)!="number")return[e];for(t=new Array(n);n--;)t[n]=e[n];return t}for(n=arguments.length,t=new Array(n);n--;)t[n]=arguments[n];return t}var qe=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},ln=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],de=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(ln),un={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Pe(e,n){this.name=e,this.message=n}function ve(e,n){return e+". Errors: "+Object.keys(n).map(function(t){return n[t].toString()}).filter(function(t,r,a){return a.indexOf(t)===r}).join(`
`)}function An(e,n,t,r){this.failures=n,this.failedKeys=r,this.successCount=t,this.message=ve(e,n)}function Xe(e,n){this.name="BulkError",this.failures=Object.keys(n).map(function(t){return n[t]}),this.failuresByPos=n,this.message=ve(e,this.failures)}me(Pe).from(Error).extend({toString:function(){return this.name+": "+this.message}}),me(An).from(Pe),me(Xe).from(Pe);var ot=de.reduce(function(e,n){return e[n]=n+"Error",e},{}),Kr=Pe,D=de.reduce(function(e,n){var t=n+"Error";function r(a,i){this.name=t,a?typeof a=="string"?(this.message="".concat(a).concat(i?`
 `+i:""),this.inner=i||null):typeof a=="object"&&(this.message="".concat(a.name," ").concat(a.message),this.inner=a):(this.message=un[n]||t,this.inner=null)}return me(r).from(Kr),e[n]=r,e},{});D.Syntax=SyntaxError,D.Type=TypeError,D.Range=RangeError;var zt=ln.reduce(function(e,n){return e[n+"Error"]=D[n],e},{}),Sn=de.reduce(function(e,n){return["Syntax","Type","Range"].indexOf(n)===-1&&(e[n+"Error"]=D[n]),e},{});function W(){}function sn(e){return e}function Cr(e,n){return e==null||e===sn?n:function(t){return n(e(t))}}function Re(e,n){return function(){e.apply(this,arguments),n.apply(this,arguments)}}function Tr(e,n){return e===W?n:function(){var t=e.apply(this,arguments);t!==void 0&&(arguments[0]=t);var r=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var i=n.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Re(r,this.onsuccess):r),a&&(this.onerror=this.onerror?Re(a,this.onerror):a),i!==void 0?i:t}}function Dr(e,n){return e===W?n:function(){e.apply(this,arguments);var t=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,n.apply(this,arguments),t&&(this.onsuccess=this.onsuccess?Re(t,this.onsuccess):t),r&&(this.onerror=this.onerror?Re(r,this.onerror):r)}}function jr(e,n){return e===W?n:function(t){var r=e.apply(this,arguments);J(t,r);var a=this.onsuccess,i=this.onerror;return this.onsuccess=null,this.onerror=null,t=n.apply(this,arguments),a&&(this.onsuccess=this.onsuccess?Re(a,this.onsuccess):a),i&&(this.onerror=this.onerror?Re(i,this.onerror):i),r===void 0?t===void 0?void 0:t:J(r,t)}}function qr(e,n){return e===W?n:function(){return n.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function ut(e,n){return e===W?n:function(){var t=e.apply(this,arguments);if(t&&typeof t.then=="function"){for(var r=this,a=arguments.length,i=new Array(a);a--;)i[a]=arguments[a];return t.then(function(){return n.apply(r,i)})}return n.apply(this,arguments)}}Sn.ModifyError=An,Sn.DexieError=Pe,Sn.BulkError=Xe;var ge=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Wt(e){ge=e}var cn={},Yt=100,Be=typeof Promise>"u"?[]:function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,he(e),e];var n=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[n,he(n),e]}(),ln=Be[0],de=Be[1],Be=Be[2],de=de&&de.then,Fe=ln&&ln.constructor,st=!!Be,fn=function(e,n){dn.push([e,n]),En&&(queueMicrotask(Br),En=!1)},ct=!0,En=!0,Me=[],Kn=[],lt=sn,Oe={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:W,pgp:!1,env:{},finalize:W},T=Oe,dn=[],Ne=0,Cn=[];function E(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var n=this._PSD=T;if(typeof e!="function"){if(e!==cn)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&dt(this,this._value))}this._state=null,this._value=null,++n.ref,function t(r,a){try{a(function(i){if(r._state===null){if(i===r)throw new TypeError("A promise cannot be resolved with itself.");var o=r._lib&&He();i&&typeof i.then=="function"?t(r,function(u,c){i instanceof E?i._then(u,c):i.then(u,c)}):(r._state=!0,r._value=i,Qt(r)),o&&Je()}},dt.bind(null,r))}catch(i){dt(r,i)}}(this,e)}var ft={get:function(){var e=T,n=qn;function t(r,a){var i=this,o=!e.global&&(e!==T||n!==qn),u=o&&!Se(),c=new E(function(f,p){ht(i,new $t(Xt(r,e,o,u),Xt(a,e,o,u),f,p,e))});return this._consoleTask&&(c._consoleTask=this._consoleTask),c}return t.prototype=cn,t},set:function(e){ye(this,"then",e&&e.prototype===cn?ft:{get:function(){return e},set:ft.set})}};function $t(e,n,t,r,a){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof n=="function"?n:null,this.resolve=t,this.reject=r,this.psd=a}function dt(e,n){var t,r;Kn.push(n),e._state===null&&(t=e._lib&&He(),n=lt(n),e._state=!1,e._value=n,r=e,Me.some(function(a){return a._value===r._value})||Me.push(r),Qt(e),t&&Je())}function Qt(e){var n=e._listeners;e._listeners=[];for(var t=0,r=n.length;t<r;++t)ht(e,n[t]);var a=e._PSD;--a.ref||a.finalize(),Ne===0&&(++Ne,fn(function(){--Ne==0&&pt()},[]))}function ht(e,n){if(e._state!==null){var t=e._state?n.onFulfilled:n.onRejected;if(t===null)return(e._state?n.resolve:n.reject)(e._value);++n.psd.ref,++Ne,fn(Rr,[t,e,n])}else e._listeners.push(n)}function Rr(e,n,t){try{var r,a=n._value;!n._state&&Kn.length&&(Kn=[]),r=ge&&n._consoleTask?n._consoleTask.run(function(){return e(a)}):e(a),n._state||Kn.indexOf(a)!==-1||function(i){for(var o=Me.length;o;)if(Me[--o]._value===i._value)return Me.splice(o,1)}(n),t.resolve(r)}catch(i){t.reject(i)}finally{--Ne==0&&pt(),--t.psd.ref||t.psd.finalize()}}function Br(){Le(Oe,function(){He()&&Je()})}function He(){var e=ct;return En=ct=!1,e}function Je(){var e,n,t;do for(;0<dn.length;)for(e=dn,dn=[],t=e.length,n=0;n<t;++n){var r=e[n];r[0].apply(null,r[1])}while(0<dn.length);En=ct=!0}function pt(){var e=Me;Me=[],e.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)});for(var n=Cn.slice(0),t=n.length;t;)n[--t]()}function Tn(e){return new E(cn,!1,e)}function $(e,n){var t=T;return function(){var r=He(),a=T;try{return Ee(t,!0),e.apply(this,arguments)}catch(i){n&&n(i)}finally{Ee(a,!1),r&&Je()}}}pe(E.prototype,{then:ft,_then:function(e,n){ht(this,new $t(null,null,e,n,T))},catch:function(e){if(arguments.length===1)return this.then(null,e);var n=e,t=arguments[1];return typeof n=="function"?this.then(null,function(r){return(r instanceof n?t:Tn)(r)}):this.then(null,function(r){return(r&&r.name===n?t:Tn)(r)})},finally:function(e){return this.then(function(n){return E.resolve(e()).then(function(){return n})},function(n){return E.resolve(e()).then(function(){return Tn(n)})})},timeout:function(e,n){var t=this;return e<1/0?new E(function(r,a){var i=setTimeout(function(){return a(new D.Timeout(n))},e);t.then(r,a).finally(clearTimeout.bind(null,i))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&ye(E.prototype,Symbol.toStringTag,"Dexie.Promise"),Oe.env=Gt(),pe(E,{all:function(){var e=q.apply(null,arguments).map(Rn);return new E(function(n,t){e.length===0&&n([]);var r=e.length;e.forEach(function(a,i){return E.resolve(a).then(function(o){e[i]=o,--r||n(e)},t)})})},resolve:function(e){return e instanceof E?e:e&&typeof e.then=="function"?new E(function(n,t){e.then(n,t)}):new E(cn,!0,e)},reject:Tn,race:function(){var e=q.apply(null,arguments).map(Rn);return new E(function(n,t){e.map(function(r){return E.resolve(r).then(n,t)})})},PSD:{get:function(){return T},set:function(e){return T=e}},totalEchoes:{get:function(){return qn}},newPSD:Ae,usePSD:Le,scheduler:{get:function(){return fn},set:function(e){fn=e}},rejectionMapper:{get:function(){return lt},set:function(e){lt=e}},follow:function(e,n){return new E(function(t,r){return Ae(function(a,i){var o=T;o.unhandleds=[],o.onunhandled=i,o.finalize=Re(function(){var u,c=this;u=function(){c.unhandleds.length===0?a():i(c.unhandleds[0])},Cn.push(function f(){u(),Cn.splice(Cn.indexOf(f),1)}),++Ne,fn(function(){--Ne==0&&pt()},[])},o.finalize),e()},n,t,r)})}}),Fe&&(Fe.allSettled&&ye(E,"allSettled",function(){var e=q.apply(null,arguments).map(Rn);return new E(function(n){e.length===0&&n([]);var t=e.length,r=new Array(t);e.forEach(function(a,i){return E.resolve(a).then(function(o){return r[i]={status:"fulfilled",value:o}},function(o){return r[i]={status:"rejected",reason:o}}).then(function(){return--t||n(r)})})})}),Fe.any&&typeof AggregateError<"u"&&ye(E,"any",function(){var e=q.apply(null,arguments).map(Rn);return new E(function(n,t){e.length===0&&t(new AggregateError([]));var r=e.length,a=new Array(r);e.forEach(function(i,o){return E.resolve(i).then(function(u){return n(u)},function(u){a[o]=u,--r||t(new AggregateError(a))})})})}),Fe.withResolvers&&(E.withResolvers=Fe.withResolvers));var Z={awaits:0,echoes:0,id:0},Fr=0,Dn=[],jn=0,qn=0,Mr=0;function Ae(e,n,t,r){var a=T,i=Object.create(a);return i.parent=a,i.ref=0,i.global=!1,i.id=++Mr,Oe.env,i.env=st?{Promise:E,PromiseProp:{value:E,configurable:!0,writable:!0},all:E.all,race:E.race,allSettled:E.allSettled,any:E.any,resolve:E.resolve,reject:E.reject}:{},n&&J(i,n),++a.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()},r=Le(i,e,t,r),i.ref===0&&i.finalize(),r}function Ze(){return Z.id||(Z.id=++Fr),++Z.awaits,Z.echoes+=Yt,Z.id}function Se(){return!!Z.awaits&&(--Z.awaits==0&&(Z.id=0),Z.echoes=Z.awaits*Yt,!0)}function Rn(e){return Z.echoes&&e&&e.constructor===Fe?(Ze(),e.then(function(n){return Se(),n},function(n){return Se(),G(n)})):e}function Nr(){var e=Dn[Dn.length-1];Dn.pop(),Ee(e,!1)}function Ee(e,n){var t,r=T;(n?!Z.echoes||jn++&&e===T:!jn||--jn&&e===T)||queueMicrotask(n?(function(a){++qn,Z.echoes&&--Z.echoes!=0||(Z.echoes=Z.awaits=Z.id=0),Dn.push(T),Ee(a,!0)}).bind(null,e):Nr),e!==T&&(T=e,r===Oe&&(Oe.env=Gt()),st&&(t=Oe.env.Promise,n=e.env,(r.global||e.global)&&(Object.defineProperty(Q,"Promise",n.PromiseProp),t.all=n.all,t.race=n.race,t.resolve=n.resolve,t.reject=n.reject,n.allSettled&&(t.allSettled=n.allSettled),n.any&&(t.any=n.any))))}function Gt(){var e=Q.Promise;return st?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(Q,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function Le(e,n,t,r,a){var i=T;try{return Ee(e,!0),n(t,r,a)}finally{Ee(i,!1)}}function Xt(e,n,t,r){return typeof e!="function"?e:function(){var a=T;t&&Ze(),Ee(n,!0);try{return e.apply(this,arguments)}finally{Ee(a,!1),r&&queueMicrotask(Se)}}}function yt(e){Promise===Fe&&Z.echoes===0?jn===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+de).indexOf("[native code]")===-1&&(Ze=Se=W);var G=E.reject,Ve="￿",xe="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Ht="String expected.",en=[],Bn="__dbnames",mt="readonly",vt="readwrite";function Ue(e,n){return e?n?function(){return e.apply(this,arguments)&&n.apply(this,arguments)}:e:n}var Jt={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Fn(e){return typeof e!="string"||/\./.test(e)?function(n){return n}:function(n){return n[e]===void 0&&e in n&&delete(n=_e(n))[e],n}}function Zt(){throw D.Type()}function N(e,n){try{var t=er(e),r=er(n);if(t!==r)return t==="Array"?1:r==="Array"?-1:t==="binary"?1:r==="binary"?-1:t==="string"?1:r==="string"?-1:t==="Date"?1:r!=="Date"?NaN:-1;switch(t){case"number":case"Date":case"string":return n<e?1:e<n?-1:0;case"binary":return function(a,i){for(var o=a.length,u=i.length,c=o<u?o:u,f=0;f<c;++f)if(a[f]!==i[f])return a[f]<i[f]?-1:1;return o===u?0:o<u?-1:1}(nr(e),nr(n));case"Array":return function(a,i){for(var o=a.length,u=i.length,c=o<u?o:u,f=0;f<c;++f){var p=N(a[f],i[f]);if(p!==0)return p}return o===u?0:o<u?-1:1}(e,n)}}catch{}return NaN}function er(e){var n=typeof e;return n!="object"?n:ArrayBuffer.isView(e)?"binary":(e=on(e),e==="ArrayBuffer"?"binary":e)}function nr(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var tr=(Y.prototype._trans=function(e,n,t){var r=this._tx||T.trans,a=this.name,i=ge&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function o(f,p,s){if(!s.schema[a])throw new D.NotFound("Table "+a+" not part of transaction");return n(s.idbtrans,s)}var u=He();try{var c=r&&r.db._novip===this.db._novip?r===T.trans?r._promise(e,o,t):Ae(function(){return r._promise(e,o,t)},{trans:r,transless:T.transless||T}):function f(p,s,m,l){if(p.idbdb&&(p._state.openComplete||T.letThrough||p._vip)){var h=p._createTransaction(s,m,p._dbSchema);try{h.create(),p._state.PR1398_maxLoop=3}catch(y){return y.name===ot.InvalidState&&p.isOpen()&&0<--p._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),p.close({disableAutoOpen:!1}),p.open().then(function(){return f(p,s,m,l)})):G(y)}return h._promise(s,function(y,d){return Ae(function(){return T.trans=h,l(y,d,h)})}).then(function(y){if(s==="readwrite")try{h.idbtrans.commit()}catch{}return s==="readonly"?y:h._completion.then(function(){return y})})}if(p._state.openComplete)return G(new D.DatabaseClosed(p._state.dbOpenError));if(!p._state.isBeingOpened){if(!p._state.autoOpen)return G(new D.DatabaseClosed);p.open().catch(W)}return p._state.dbReadyPromise.then(function(){return f(p,s,m,l)})}(this.db,e,[this.name],o);return i&&(c._consoleTask=i,c=c.catch(function(f){return console.trace(f),G(f)})),c}finally{u&&Je()}},Y.prototype.get=function(e,n){var t=this;return e&&e.constructor===Object?this.where(e).first(n):e==null?G(new D.Type("Invalid argument to Table.get()")):this._trans("readonly",function(r){return t.core.get({trans:r,key:e}).then(function(a){return t.hook.reading.fire(a)})}).then(n)},Y.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(z(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var n=U(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);var t=this.schema.indexes.concat(this.schema.primKey).filter(function(u){if(u.compound&&n.every(function(f){return 0<=u.keyPath.indexOf(f)})){for(var c=0;c<n.length;++c)if(n.indexOf(u.keyPath[c])===-1)return!1;return!0}return!1}).sort(function(u,c){return u.keyPath.length-c.keyPath.length})[0];if(t&&this.db._maxKey!==Ve){var i=t.keyPath.slice(0,n.length);return this.where(i).equals(i.map(function(c){return e[c]}))}!t&&ge&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(n.join("+"),"]"));var r=this.schema.idxByName;function a(u,c){return N(u,c)===0}var o=n.reduce(function(s,c){var f=s[0],p=s[1],s=r[c],m=e[c];return[f||s,f||!s?Ue(p,s&&s.multi?function(l){return l=fe(l,c),z(l)&&l.some(function(h){return a(m,h)})}:function(l){return a(m,fe(l,c))}):p]},[null,null]),i=o[0],o=o[1];return i?this.where(i.name).equals(e[i.keyPath]).filter(o):t?this.filter(o):this.where(n).equals("")},Y.prototype.filter=function(e){return this.toCollection().and(e)},Y.prototype.count=function(e){return this.toCollection().count(e)},Y.prototype.offset=function(e){return this.toCollection().offset(e)},Y.prototype.limit=function(e){return this.toCollection().limit(e)},Y.prototype.each=function(e){return this.toCollection().each(e)},Y.prototype.toArray=function(e){return this.toCollection().toArray(e)},Y.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Y.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,z(e)?"[".concat(e.join("+"),"]"):e))},Y.prototype.reverse=function(){return this.toCollection().reverse()},Y.prototype.mapToClass=function(e){var n,t=this.db,r=this.name;function a(){return n!==null&&n.apply(this,arguments)||this}(this.schema.mappedClass=e).prototype instanceof Zt&&(function(c,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");function p(){this.constructor=c}ne(c,f),c.prototype=f===null?Object.create(f):(p.prototype=f.prototype,new p)}(a,n=e),Object.defineProperty(a.prototype,"db",{get:function(){return t},enumerable:!1,configurable:!0}),a.prototype.table=function(){return r},e=a);for(var i=new Set,o=e.prototype;o;o=he(o))Object.getOwnPropertyNames(o).forEach(function(c){return i.add(c)});function u(c){if(!c)return c;var f,p=Object.create(e.prototype);for(f in c)if(!i.has(f))try{p[f]=c[f]}catch{}return p}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=u,this.hook("reading",u),e},Y.prototype.defineClass=function(){return this.mapToClass(function(e){J(this,e)})},Y.prototype.add=function(e,n){var t=this,r=this.schema.primKey,a=r.auto,i=r.keyPath,o=e;return i&&a&&(o=Fn(i)(e)),this._trans("readwrite",function(u){return t.core.mutate({trans:u,type:"add",keys:n!=null?[n]:null,values:[o]})}).then(function(u){return u.numFailures?E.reject(u.failures[0]):u.lastResult}).then(function(u){if(i)try{ue(e,i,u)}catch{}return u})},Y.prototype.update=function(e,n){return typeof e!="object"||z(e)?this.where(":id").equals(e).modify(n):(e=fe(e,this.schema.primKey.keyPath),e===void 0?G(new D.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(n))},Y.prototype.put=function(e,n){var t=this,r=this.schema.primKey,a=r.auto,i=r.keyPath,o=e;return i&&a&&(o=Fn(i)(e)),this._trans("readwrite",function(u){return t.core.mutate({trans:u,type:"put",values:[o],keys:n!=null?[n]:null})}).then(function(u){return u.numFailures?E.reject(u.failures[0]):u.lastResult}).then(function(u){if(i)try{ue(e,i,u)}catch{}return u})},Y.prototype.delete=function(e){var n=this;return this._trans("readwrite",function(t){return n.core.mutate({trans:t,type:"delete",keys:[e]})}).then(function(t){return t.numFailures?E.reject(t.failures[0]):void 0})},Y.prototype.clear=function(){var e=this;return this._trans("readwrite",function(n){return e.core.mutate({trans:n,type:"deleteRange",range:Jt})}).then(function(n){return n.numFailures?E.reject(n.failures[0]):void 0})},Y.prototype.bulkGet=function(e){var n=this;return this._trans("readonly",function(t){return n.core.getMany({keys:e,trans:t}).then(function(r){return r.map(function(a){return n.hook.reading.fire(a)})})})},Y.prototype.bulkAdd=function(e,n,t){var r=this,a=Array.isArray(n)?n:void 0,i=(t=t||(a?void 0:n))?t.allKeys:void 0;return this._trans("readwrite",function(o){var f=r.schema.primKey,u=f.auto,f=f.keyPath;if(f&&a)throw new D.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(a&&a.length!==e.length)throw new D.InvalidArgument("Arguments objects and keys must have the same length");var c=e.length,f=f&&u?e.map(Fn(f)):e;return r.core.mutate({trans:o,type:"add",keys:a,values:f,wantResults:i}).then(function(h){var s=h.numFailures,m=h.results,l=h.lastResult,h=h.failures;if(s===0)return i?m:l;throw new Xe("".concat(r.name,".bulkAdd(): ").concat(s," of ").concat(c," operations failed"),h)})})},Y.prototype.bulkPut=function(e,n,t){var r=this,a=Array.isArray(n)?n:void 0,i=(t=t||(a?void 0:n))?t.allKeys:void 0;return this._trans("readwrite",function(o){var f=r.schema.primKey,u=f.auto,f=f.keyPath;if(f&&a)throw new D.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(a&&a.length!==e.length)throw new D.InvalidArgument("Arguments objects and keys must have the same length");var c=e.length,f=f&&u?e.map(Fn(f)):e;return r.core.mutate({trans:o,type:"put",keys:a,values:f,wantResults:i}).then(function(h){var s=h.numFailures,m=h.results,l=h.lastResult,h=h.failures;if(s===0)return i?m:l;throw new Xe("".concat(r.name,".bulkPut(): ").concat(s," of ").concat(c," operations failed"),h)})})},Y.prototype.bulkUpdate=function(e){var n=this,t=this.core,r=e.map(function(o){return o.key}),a=e.map(function(o){return o.changes}),i=[];return this._trans("readwrite",function(o){return t.getMany({trans:o,keys:r,cache:"clone"}).then(function(u){var c=[],f=[];e.forEach(function(s,m){var l=s.key,h=s.changes,y=u[m];if(y){for(var d=0,v=Object.keys(h);d<v.length;d++){var g=v[d],b=h[g];if(g===n.schema.primKey.keyPath){if(N(b,l)!==0)throw new D.Constraint("Cannot update primary key in bulkUpdate()")}else ue(y,g,b)}i.push(m),c.push(l),f.push(y)}});var p=c.length;return t.mutate({trans:o,type:"put",keys:c,values:f,updates:{keys:r,changeSpecs:a}}).then(function(s){var m=s.numFailures,l=s.failures;if(m===0)return p;for(var h=0,y=Object.keys(l);h<y.length;h++){var d,v=y[h],g=i[Number(v)];g!=null&&(d=l[v],delete l[v],l[g]=d)}throw new Xe("".concat(n.name,".bulkUpdate(): ").concat(m," of ").concat(p," operations failed"),l)})})})},Y.prototype.bulkDelete=function(e){var n=this,t=e.length;return this._trans("readwrite",function(r){return n.core.mutate({trans:r,type:"delete",keys:e})}).then(function(o){var a=o.numFailures,i=o.lastResult,o=o.failures;if(a===0)return i;throw new Xe("".concat(n.name,".bulkDelete(): ").concat(a," of ").concat(t," operations failed"),o)})},Y);function Y(){}function hn(e){function n(o,u){if(u){for(var c=arguments.length,f=new Array(c-1);--c;)f[c-1]=arguments[c];return t[o].subscribe.apply(null,f),e}if(typeof o=="string")return t[o]}var t={};n.addEventType=i;for(var r=1,a=arguments.length;r<a;++r)i(arguments[r]);return n;function i(o,u,c){if(typeof o!="object"){var f;u=u||qr;var p={subscribers:[],fire:c=c||W,subscribe:function(s){p.subscribers.indexOf(s)===-1&&(p.subscribers.push(s),p.fire=u(p.fire,s))},unsubscribe:function(s){p.subscribers=p.subscribers.filter(function(m){return m!==s}),p.fire=p.subscribers.reduce(u,c)}};return t[o]=n[o]=p}U(f=o).forEach(function(s){var m=f[s];if(z(m))i(s,f[s][0],f[s][1]);else{if(m!=="asap")throw new D.InvalidArgument("Invalid event config");var l=i(s,sn,function(){for(var h=arguments.length,y=new Array(h);h--;)y[h]=arguments[h];l.subscribers.forEach(function(d){Qe(function(){d.apply(null,y)})})})}})}}function pn(e,n){return me(n).from({prototype:e}),n}function nn(e,n){return!(e.filter||e.algorithm||e.or)&&(n?e.justLimit:!e.replayFilter)}function gt(e,n){e.filter=Ue(e.filter,n)}function bt(e,n,t){var r=e.replayFilter;e.replayFilter=r?function(){return Ue(r(),n())}:n,e.justLimit=t&&!r}function Mn(e,n){if(e.isPrimKey)return n.primaryKey;var t=n.getIndexByKeyPath(e.index);if(!t)throw new D.Schema("KeyPath "+e.index+" on object store "+n.name+" is not indexed");return t}function rr(e,n,t){var r=Mn(e,n.schema);return n.openCursor({trans:t,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:r,range:e.range}})}function Nn(e,n,t,r){var a=e.replayFilter?Ue(e.filter,e.replayFilter()):e.filter;if(e.or){var i={},o=function(u,c,f){var p,s;a&&!a(c,f,function(m){return c.stop(m)},function(m){return c.fail(m)})||((s=""+(p=c.primaryKey))=="[object ArrayBuffer]"&&(s=""+new Uint8Array(p)),L(i,s)||(i[s]=!0,n(u,c,f)))};return Promise.all([e.or._iterate(o,t),ar(rr(e,r,t),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return ar(rr(e,r,t),Ue(e.algorithm,a),n,!e.keysOnly&&e.valueMapper)}function ar(e,n,t,r){var a=$(r?function(i,o,u){return t(r(i),o,u)}:t);return e.then(function(i){if(i)return i.start(function(){var o=function(){return i.continue()};n&&!n(i,function(u){return o=u},function(u){i.stop(u),o=W},function(u){i.fail(u),o=W})||a(i.value,i,function(u){return o=u}),o()})})}var yn=(ir.prototype.execute=function(e){var n=this["@@propmod"];if(n.add!==void 0){var t=n.add;if(z(t))return oe(oe([],z(e)?e:[],!0),t).sort();if(typeof t=="number")return(Number(e)||0)+t;if(typeof t=="bigint")try{return BigInt(e)+t}catch{return BigInt(0)+t}throw new TypeError("Invalid term ".concat(t))}if(n.remove!==void 0){var r=n.remove;if(z(r))return z(e)?e.filter(function(a){return!r.includes(a)}).sort():[];if(typeof r=="number")return Number(e)-r;if(typeof r=="bigint")try{return BigInt(e)-r}catch{return BigInt(0)-r}throw new TypeError("Invalid subtrahend ".concat(r))}return t=(t=n.replacePrefix)===null||t===void 0?void 0:t[0],t&&typeof e=="string"&&e.startsWith(t)?n.replacePrefix[1]+e.substring(t.length):e},ir);function ir(e){this["@@propmod"]=e}var Lr=(V.prototype._read=function(e,n){var t=this._ctx;return t.error?t.table._trans(null,G.bind(null,t.error)):t.table._trans("readonly",e).then(n)},V.prototype._write=function(e){var n=this._ctx;return n.error?n.table._trans(null,G.bind(null,n.error)):n.table._trans("readwrite",e,"locked")},V.prototype._addAlgorithm=function(e){var n=this._ctx;n.algorithm=Ue(n.algorithm,e)},V.prototype._iterate=function(e,n){return Nn(this._ctx,e,n,this._ctx.table.core)},V.prototype.clone=function(e){var n=Object.create(this.constructor.prototype),t=Object.create(this._ctx);return e&&J(t,e),n._ctx=t,n},V.prototype.raw=function(){return this._ctx.valueMapper=null,this},V.prototype.each=function(e){var n=this._ctx;return this._read(function(t){return Nn(n,e,t,n.table.core)})},V.prototype.count=function(e){var n=this;return this._read(function(t){var r=n._ctx,a=r.table.core;if(nn(r,!0))return a.count({trans:t,query:{index:Mn(r,a.schema),range:r.range}}).then(function(o){return Math.min(o,r.limit)});var i=0;return Nn(r,function(){return++i,!1},t,a).then(function(){return i})}).then(e)},V.prototype.sortBy=function(e,n){var t=e.split(".").reverse(),r=t[0],a=t.length-1;function i(c,f){return f?i(c[t[f]],f-1):c[r]}var o=this._ctx.dir==="next"?1:-1;function u(c,f){return N(i(c,a),i(f,a))*o}return this.toArray(function(c){return c.sort(u)}).then(n)},V.prototype.toArray=function(e){var n=this;return this._read(function(t){var r=n._ctx;if(r.dir==="next"&&nn(r,!0)&&0<r.limit){var a=r.valueMapper,i=Mn(r,r.table.core.schema);return r.table.core.query({trans:t,limit:r.limit,values:!0,query:{index:i,range:r.range}}).then(function(u){return u=u.result,a?u.map(a):u})}var o=[];return Nn(r,function(u){return o.push(u)},t,r.table.core).then(function(){return o})},e)},V.prototype.offset=function(e){var n=this._ctx;return e<=0||(n.offset+=e,nn(n)?bt(n,function(){var t=e;return function(r,a){return t===0||(t===1?--t:a(function(){r.advance(t),t=0}),!1)}}):bt(n,function(){var t=e;return function(){return--t<0}})),this},V.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),bt(this._ctx,function(){var n=e;return function(t,r,a){return--n<=0&&r(a),0<=n}},!0),this},V.prototype.until=function(e,n){return gt(this._ctx,function(t,r,a){return!e(t.value)||(r(a),n)}),this},V.prototype.first=function(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)},V.prototype.last=function(e){return this.reverse().first(e)},V.prototype.filter=function(e){var n;return gt(this._ctx,function(t){return e(t.value)}),(n=this._ctx).isMatch=Ue(n.isMatch,e),this},V.prototype.and=function(e){return this.filter(e)},V.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},V.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},V.prototype.desc=function(){return this.reverse()},V.prototype.eachKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(t,r){e(r.key,r)})},V.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},V.prototype.eachPrimaryKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(t,r){e(r.primaryKey,r)})},V.prototype.keys=function(e){var n=this._ctx;n.keysOnly=!n.isMatch;var t=[];return this.each(function(r,a){t.push(a.key)}).then(function(){return t}).then(e)},V.prototype.primaryKeys=function(e){var n=this._ctx;if(n.dir==="next"&&nn(n,!0)&&0<n.limit)return this._read(function(r){var a=Mn(n,n.table.core.schema);return n.table.core.query({trans:r,values:!1,limit:n.limit,query:{index:a,range:n.range}})}).then(function(r){return r.result}).then(e);n.keysOnly=!n.isMatch;var t=[];return this.each(function(r,a){t.push(a.primaryKey)}).then(function(){return t}).then(e)},V.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},V.prototype.firstKey=function(e){return this.limit(1).keys(function(n){return n[0]}).then(e)},V.prototype.lastKey=function(e){return this.reverse().firstKey(e)},V.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var n={};return gt(this._ctx,function(a){var r=a.primaryKey.toString(),a=L(n,r);return n[r]=!0,!a}),this},V.prototype.modify=function(e){var n=this,t=this._ctx;return this._write(function(r){var a,i,o;o=typeof e=="function"?e:(a=U(e),i=a.length,function(d){for(var v=!1,g=0;g<i;++g){var b=a[g],w=e[b],x=fe(d,b);w instanceof yn?(ue(d,b,w.execute(x)),v=!0):x!==w&&(ue(d,b,w),v=!0)}return v});var u=t.table.core,s=u.schema.primaryKey,c=s.outbound,f=s.extractKey,p=200,s=n.db._options.modifyChunkSize;s&&(p=typeof s=="object"?s[u.name]||s["*"]||200:s);function m(d,b){var g=b.failures,b=b.numFailures;h+=d-b;for(var w=0,x=U(g);w<x.length;w++){var A=x[w];l.push(g[A])}}var l=[],h=0,y=[];return n.clone().primaryKeys().then(function(d){function v(b){var w=Math.min(p,d.length-b);return u.getMany({trans:r,keys:d.slice(b,b+w),cache:"immutable"}).then(function(x){for(var A=[],k=[],I=c?[]:null,S=[],O=0;O<w;++O){var K=x[O],B={value:_e(K),primKey:d[b+O]};o.call(B,B.value,B)!==!1&&(B.value==null?S.push(d[b+O]):c||N(f(K),f(B.value))===0?(k.push(B.value),c&&I.push(d[b+O])):(S.push(d[b+O]),A.push(B.value)))}return Promise.resolve(0<A.length&&u.mutate({trans:r,type:"add",values:A}).then(function(F){for(var M in F.failures)S.splice(parseInt(M),1);m(A.length,F)})).then(function(){return(0<k.length||g&&typeof e=="object")&&u.mutate({trans:r,type:"put",keys:I,values:k,criteria:g,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<b}).then(function(F){return m(k.length,F)})}).then(function(){return(0<S.length||g&&e===wt)&&u.mutate({trans:r,type:"delete",keys:S,criteria:g,isAdditionalChunk:0<b}).then(function(F){return m(S.length,F)})}).then(function(){return d.length>b+w&&v(b+p)})})}var g=nn(t)&&t.limit===1/0&&(typeof e!="function"||e===wt)&&{index:t.index,range:t.range};return v(0).then(function(){if(0<l.length)throw new An("Error modifying one or more objects",l,h,y);return d.length})})})},V.prototype.delete=function(){var e=this._ctx,n=e.range;return nn(e)&&(e.isPrimKey||n.type===3)?this._write(function(t){var r=e.table.core.schema.primaryKey,a=n;return e.table.core.count({trans:t,query:{index:r,range:a}}).then(function(i){return e.table.core.mutate({trans:t,type:"deleteRange",range:a}).then(function(o){var u=o.failures;if(o.lastResult,o.results,o=o.numFailures,o)throw new An("Could not delete some values",Object.keys(u).map(function(c){return u[c]}),i-o);return i-o})})}):this.modify(wt)},V);function V(){}var wt=function(e,n){return n.value=null};function Vr(e,n){return e<n?-1:e===n?0:1}function Ur(e,n){return n<e?-1:e===n?0:1}function ce(e,n,t){return e=e instanceof ur?new e.Collection(e):e,e._ctx.error=new(t||TypeError)(n),e}function tn(e){return new e.Collection(e,function(){return or("")}).limit(0)}function Ln(e,n,t,r){var a,i,o,u,c,f,p,s=t.length;if(!t.every(function(h){return typeof h=="string"}))return ce(e,Ht);function m(h){a=h==="next"?function(d){return d.toUpperCase()}:function(d){return d.toLowerCase()},i=h==="next"?function(d){return d.toLowerCase()}:function(d){return d.toUpperCase()},o=h==="next"?Vr:Ur;var y=t.map(function(d){return{lower:i(d),upper:a(d)}}).sort(function(d,v){return o(d.lower,v.lower)});u=y.map(function(d){return d.upper}),c=y.map(function(d){return d.lower}),p=(f=h)==="next"?"":r}m("next"),e=new e.Collection(e,function(){return Ke(u[0],c[s-1]+r)}),e._ondirectionchange=function(h){m(h)};var l=0;return e._addAlgorithm(function(h,y,d){var v=h.key;if(typeof v!="string")return!1;var g=i(v);if(n(g,c,l))return!0;for(var b=null,w=l;w<s;++w){var x=function(A,k,I,S,O,K){for(var B=Math.min(A.length,S.length),F=-1,M=0;M<B;++M){var le=k[M];if(le!==S[M])return O(A[M],I[M])<0?A.substr(0,M)+I[M]+I.substr(M+1):O(A[M],S[M])<0?A.substr(0,M)+S[M]+I.substr(M+1):0<=F?A.substr(0,F)+k[F]+I.substr(F+1):null;O(A[M],le)<0&&(F=M)}return B<S.length&&K==="next"?A+I.substr(A.length):B<A.length&&K==="prev"?A.substr(0,I.length):F<0?null:A.substr(0,F)+S[F]+I.substr(F+1)}(v,g,u[w],c[w],o,f);x===null&&b===null?l=w+1:(b===null||0<o(b,x))&&(b=x)}return y(b!==null?function(){h.continue(b+p)}:d),!1}),e}function Ke(e,n,t,r){return{type:2,lower:e,upper:n,lowerOpen:t,upperOpen:r}}function or(e){return{type:1,lower:e,upper:e}}var ur=(Object.defineProperty(ee.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),ee.prototype.between=function(e,n,t,r){t=t!==!1,r=r===!0;try{return 0<this._cmp(e,n)||this._cmp(e,n)===0&&(t||r)&&(!t||!r)?tn(this):new this.Collection(this,function(){return Ke(e,n,!t,!r)})}catch{return ce(this,xe)}},ee.prototype.equals=function(e){return e==null?ce(this,xe):new this.Collection(this,function(){return or(e)})},ee.prototype.above=function(e){return e==null?ce(this,xe):new this.Collection(this,function(){return Ke(e,void 0,!0)})},ee.prototype.aboveOrEqual=function(e){return e==null?ce(this,xe):new this.Collection(this,function(){return Ke(e,void 0,!1)})},ee.prototype.below=function(e){return e==null?ce(this,xe):new this.Collection(this,function(){return Ke(void 0,e,!1,!0)})},ee.prototype.belowOrEqual=function(e){return e==null?ce(this,xe):new this.Collection(this,function(){return Ke(void 0,e)})},ee.prototype.startsWith=function(e){return typeof e!="string"?ce(this,Ht):this.between(e,e+Ve,!0,!0)},ee.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):Ln(this,function(n,t){return n.indexOf(t[0])===0},[e],Ve)},ee.prototype.equalsIgnoreCase=function(e){return Ln(this,function(n,t){return n===t[0]},[e],"")},ee.prototype.anyOfIgnoreCase=function(){var e=q.apply(P,arguments);return e.length===0?tn(this):Ln(this,function(n,t){return t.indexOf(n)!==-1},e,"")},ee.prototype.startsWithAnyOfIgnoreCase=function(){var e=q.apply(P,arguments);return e.length===0?tn(this):Ln(this,function(n,t){return t.some(function(r){return n.indexOf(r)===0})},e,Ve)},ee.prototype.anyOf=function(){var e=this,n=q.apply(P,arguments),t=this._cmp;try{n.sort(t)}catch{return ce(this,xe)}if(n.length===0)return tn(this);var r=new this.Collection(this,function(){return Ke(n[0],n[n.length-1])});r._ondirectionchange=function(i){t=i==="next"?e._ascending:e._descending,n.sort(t)};var a=0;return r._addAlgorithm(function(i,o,u){for(var c=i.key;0<t(c,n[a]);)if(++a===n.length)return o(u),!1;return t(c,n[a])===0||(o(function(){i.continue(n[a])}),!1)}),r},ee.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},ee.prototype.noneOf=function(){var e=q.apply(P,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return ce(this,xe)}var n=e.reduce(function(t,r){return t?t.concat([[t[t.length-1][1],r]]):[[-1/0,r]]},null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})},ee.prototype.inAnyRange=function(v,n){var t=this,r=this._cmp,a=this._ascending,i=this._descending,o=this._min,u=this._max;if(v.length===0)return tn(this);if(!v.every(function(g){return g[0]!==void 0&&g[1]!==void 0&&a(g[0],g[1])<=0}))return ce(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",D.InvalidArgument);var c=!n||n.includeLowers!==!1,f=n&&n.includeUppers===!0,p,s=a;function m(g,b){return s(g[0],b[0])}try{(p=v.reduce(function(g,b){for(var w=0,x=g.length;w<x;++w){var A=g[w];if(r(b[0],A[1])<0&&0<r(b[1],A[0])){A[0]=o(A[0],b[0]),A[1]=u(A[1],b[1]);break}}return w===x&&g.push(b),g},[])).sort(m)}catch{return ce(this,xe)}var l=0,h=f?function(g){return 0<a(g,p[l][1])}:function(g){return 0<=a(g,p[l][1])},y=c?function(g){return 0<i(g,p[l][0])}:function(g){return 0<=i(g,p[l][0])},d=h,v=new this.Collection(this,function(){return Ke(p[0][0],p[p.length-1][1],!c,!f)});return v._ondirectionchange=function(g){s=g==="next"?(d=h,a):(d=y,i),p.sort(m)},v._addAlgorithm(function(g,b,w){for(var x,A=g.key;d(A);)if(++l===p.length)return b(w),!1;return!h(x=A)&&!y(x)||(t._cmp(A,p[l][1])===0||t._cmp(A,p[l][0])===0||b(function(){s===a?g.continue(p[l][0]):g.continue(p[l][1])}),!1)}),v},ee.prototype.startsWithAnyOf=function(){var e=q.apply(P,arguments);return e.every(function(n){return typeof n=="string"})?e.length===0?tn(this):this.inAnyRange(e.map(function(n){return[n,n+Ve]})):ce(this,"startsWithAnyOf() only works with strings")},ee);function ee(){}function be(e){return $(function(n){return mn(n),e(n.target.error),!1})}function mn(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var vn="storagemutated",_t="x-storagemutated-1",Ce=hn(null,vn),zr=(we.prototype._lock=function(){return De(!T.global),++this._reculock,this._reculock!==1||T.global||(T.lockOwnerFor=this),this},we.prototype._unlock=function(){if(De(!T.global),--this._reculock==0)for(T.global||(T.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{Le(e[1],e[0])}catch{}}return this},we.prototype._locked=function(){return this._reculock&&T.lockOwnerFor!==this},we.prototype.create=function(e){var n=this;if(!this.mode)return this;var t=this.db.idbdb,r=this.db._state.dbOpenError;if(De(!this.idbtrans),!e&&!t)switch(r&&r.name){case"DatabaseClosedError":throw new D.DatabaseClosed(r);case"MissingAPIError":throw new D.MissingAPI(r.message,r);default:throw new D.OpenFailed(r)}if(!this.active)throw new D.TransactionInactive;return De(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||t).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=$(function(a){mn(a),n._reject(e.error)}),e.onabort=$(function(a){mn(a),n.active&&n._reject(new D.Abort(e.error)),n.active=!1,n.on("abort").fire(a)}),e.oncomplete=$(function(){n.active=!1,n._resolve(),"mutatedParts"in e&&Ce.storagemutated.fire(e.mutatedParts)}),this},we.prototype._promise=function(e,n,t){var r=this;if(e==="readwrite"&&this.mode!=="readwrite")return G(new D.ReadOnly("Transaction is readonly"));if(!this.active)return G(new D.TransactionInactive);if(this._locked())return new E(function(i,o){r._blockedFuncs.push([function(){r._promise(e,n,t).then(i,o)},T])});if(t)return Ae(function(){var i=new E(function(o,u){r._lock();var c=n(o,u,r);c&&c.then&&c.then(o,u)});return i.finally(function(){return r._unlock()}),i._lib=!0,i});var a=new E(function(i,o){var u=n(i,o,r);u&&u.then&&u.then(i,o)});return a._lib=!0,a},we.prototype._root=function(){return this.parent?this.parent._root():this},we.prototype.waitFor=function(e){var n,t=this._root(),r=E.resolve(e);t._waitingFor?t._waitingFor=t._waitingFor.then(function(){return r}):(t._waitingFor=r,t._waitingQueue=[],n=t.idbtrans.objectStore(t.storeNames[0]),function i(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(n.get(-1/0).onsuccess=i)}());var a=t._waitingFor;return new E(function(i,o){r.then(function(u){return t._waitingQueue.push($(i.bind(null,u)))},function(u){return t._waitingQueue.push($(o.bind(null,u)))}).finally(function(){t._waitingFor===a&&(t._waitingFor=null)})})},we.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new D.Abort))},we.prototype.table=function(e){var n=this._memoizedTables||(this._memoizedTables={});if(L(n,e))return n[e];var t=this.schema[e];if(!t)throw new D.NotFound("Table "+e+" not part of transaction");return t=new this.db.Table(e,t,this),t.core=this.db.core.table(e),n[e]=t},we);function we(){}function xt(e,n,t,r,a,i,o){return{name:e,keyPath:n,unique:t,multi:r,auto:a,compound:i,src:(t&&!o?"&":"")+(r?"*":"")+(a?"++":"")+sr(n)}}function sr(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function kt(e,n,t){return{name:e,primKey:n,indexes:t,mappedClass:null,idxByName:(r=function(a){return[a.name,a]},t.reduce(function(a,i,o){return o=r(i,o),o&&(a[o[0]]=o[1]),a},{}))};var r}var gn=function(e){try{return e.only([[]]),gn=function(){return[[]]},[[]]}catch{return gn=function(){return Ve},Ve}};function It(e){return e==null?function(){}:typeof e=="string"?(n=e).split(".").length===1?function(t){return t[n]}:function(t){return fe(t,n)}:function(t){return fe(t,e)};var n}function cr(e){return[].slice.call(e)}var Wr=0;function bn(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function Yr(e,n,c){function r(d){if(d.type===3)return null;if(d.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var l=d.lower,h=d.upper,y=d.lowerOpen,d=d.upperOpen;return l===void 0?h===void 0?null:n.upperBound(h,!!d):h===void 0?n.lowerBound(l,!!y):n.bound(l,h,!!y,!!d)}function a(m){var l,h=m.name;return{name:h,schema:m,mutate:function(y){var d=y.trans,v=y.type,g=y.keys,b=y.values,w=y.range;return new Promise(function(x,A){x=$(x);var k=d.objectStore(h),I=k.keyPath==null,S=v==="put"||v==="add";if(!S&&v!=="delete"&&v!=="deleteRange")throw new Error("Invalid operation type: "+v);var O,K=(g||b||{length:1}).length;if(g&&b&&g.length!==b.length)throw new Error("Given keys array must have same length as given values array.");if(K===0)return x({numFailures:0,failures:{},results:[],lastResult:void 0});function B(se){++le,mn(se)}var F=[],M=[],le=0;if(v==="deleteRange"){if(w.type===4)return x({numFailures:le,failures:M,results:[],lastResult:void 0});w.type===3?F.push(O=k.clear()):F.push(O=k.delete(r(w)))}else{var I=S?I?[b,g]:[b,null]:[g,null],R=I[0],re=I[1];if(S)for(var ae=0;ae<K;++ae)F.push(O=re&&re[ae]!==void 0?k[v](R[ae],re[ae]):k[v](R[ae])),O.onerror=B;else for(ae=0;ae<K;++ae)F.push(O=k[v](R[ae])),O.onerror=B}function et(se){se=se.target.result,F.forEach(function(Ye,Vt){return Ye.error!=null&&(M[Vt]=Ye.error)}),x({numFailures:le,failures:M,results:v==="delete"?g:F.map(function(Ye){return Ye.result}),lastResult:se})}O.onerror=function(se){B(se),et(se)},O.onsuccess=et})},getMany:function(y){var d=y.trans,v=y.keys;return new Promise(function(g,b){g=$(g);for(var w,x=d.objectStore(h),A=v.length,k=new Array(A),I=0,S=0,O=function(F){F=F.target,k[F._pos]=F.result,++S===I&&g(k)},K=be(b),B=0;B<A;++B)v[B]!=null&&((w=x.get(v[B]))._pos=B,w.onsuccess=O,w.onerror=K,++I);I===0&&g(k)})},get:function(y){var d=y.trans,v=y.key;return new Promise(function(g,b){g=$(g);var w=d.objectStore(h).get(v);w.onsuccess=function(x){return g(x.target.result)},w.onerror=be(b)})},query:(l=f,function(y){return new Promise(function(d,v){d=$(d);var g,b,w,I=y.trans,x=y.values,A=y.limit,O=y.query,k=A===1/0?void 0:A,S=O.index,O=O.range,I=I.objectStore(h),S=S.isPrimaryKey?I:I.index(S.name),O=r(O);if(A===0)return d({result:[]});l?((k=x?S.getAll(O,k):S.getAllKeys(O,k)).onsuccess=function(K){return d({result:K.target.result})},k.onerror=be(v)):(g=0,b=!x&&"openKeyCursor"in S?S.openKeyCursor(O):S.openCursor(O),w=[],b.onsuccess=function(K){var B=b.result;return B?(w.push(x?B.value:B.primaryKey),++g===A?d({result:w}):void B.continue()):d({result:w})},b.onerror=be(v))})}),openCursor:function(y){var d=y.trans,v=y.values,g=y.query,b=y.reverse,w=y.unique;return new Promise(function(x,A){x=$(x);var S=g.index,k=g.range,I=d.objectStore(h),I=S.isPrimaryKey?I:I.index(S.name),S=b?w?"prevunique":"prev":w?"nextunique":"next",O=!v&&"openKeyCursor"in I?I.openKeyCursor(r(k),S):I.openCursor(r(k),S);O.onerror=be(A),O.onsuccess=$(function(K){var B,F,M,le,R=O.result;R?(R.___id=++Wr,R.done=!1,B=R.continue.bind(R),F=(F=R.continuePrimaryKey)&&F.bind(R),M=R.advance.bind(R),le=function(){throw new Error("Cursor not stopped")},R.trans=d,R.stop=R.continue=R.continuePrimaryKey=R.advance=function(){throw new Error("Cursor not started")},R.fail=$(A),R.next=function(){var re=this,ae=1;return this.start(function(){return ae--?re.continue():re.stop()}).then(function(){return re})},R.start=function(re){function ae(){if(O.result)try{re()}catch(se){R.fail(se)}else R.done=!0,R.start=function(){throw new Error("Cursor behind last entry")},R.stop()}var et=new Promise(function(se,Ye){se=$(se),O.onerror=be(Ye),R.fail=Ye,R.stop=function(Vt){R.stop=R.continue=R.continuePrimaryKey=R.advance=le,se(Vt)}});return O.onsuccess=$(function(se){O.onsuccess=ae,ae()}),R.continue=B,R.continuePrimaryKey=F,R.advance=M,ae(),et},x(R)):x(null)},A)})},count:function(y){var d=y.query,v=y.trans,g=d.index,b=d.range;return new Promise(function(w,x){var A=v.objectStore(h),k=g.isPrimaryKey?A:A.index(g.name),A=r(b),k=A?k.count(A):k.count();k.onsuccess=$(function(I){return w(I.target.result)}),k.onerror=be(x)})}}}var i,o,u,p=(o=c,u=cr((i=e).objectStoreNames),{schema:{name:i.name,tables:u.map(function(m){return o.objectStore(m)}).map(function(m){var l=m.keyPath,d=m.autoIncrement,h=z(l),y={},d={name:m.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:l==null,compound:h,keyPath:l,autoIncrement:d,unique:!0,extractKey:It(l)},indexes:cr(m.indexNames).map(function(v){return m.index(v)}).map(function(w){var g=w.name,b=w.unique,x=w.multiEntry,w=w.keyPath,x={name:g,compound:z(w),keyPath:w,unique:b,multiEntry:x,extractKey:It(w)};return y[bn(w)]=x}),getIndexByKeyPath:function(v){return y[bn(v)]}};return y[":id"]=d.primaryKey,l!=null&&(y[bn(l)]=d.primaryKey),d})},hasGetAll:0<u.length&&"getAll"in o.objectStore(u[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),c=p.schema,f=p.hasGetAll,p=c.tables.map(a),s={};return p.forEach(function(m){return s[m.name]=m}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(m){if(!s[m])throw new Error("Table '".concat(m,"' not found"));return s[m]},MIN_KEY:-1/0,MAX_KEY:gn(n),schema:c}}function $r(e,n,t,r){var a=t.IDBKeyRange;return t.indexedDB,{dbcore:(r=Yr(n,a,r),e.dbcore.reduce(function(i,o){return o=o.create,j(j({},i),o(i))},r))}}function Vn(e,r){var t=r.db,r=$r(e._middlewares,t,e._deps,r);e.core=r.dbcore,e.tables.forEach(function(a){var i=a.name;e.core.schema.tables.some(function(o){return o.name===i})&&(a.core=e.core.table(i),e[i]instanceof e.Table&&(e[i].core=a.core))})}function Un(e,n,t,r){t.forEach(function(a){var i=r[a];n.forEach(function(o){var u=function c(f,p){return kn(f,p)||(f=he(f))&&c(f,p)}(o,a);(!u||"value"in u&&u.value===void 0)&&(o===e.Transaction.prototype||o instanceof e.Transaction?ye(o,a,{get:function(){return this.table(a)},set:function(c){xn(this,a,{value:c,writable:!0,configurable:!0,enumerable:!0})}}):o[a]=new e.Table(a,i))})})}function Pt(e,n){n.forEach(function(t){for(var r in t)t[r]instanceof e.Table&&delete t[r]})}function Qr(e,n){return e._cfg.version-n._cfg.version}function Gr(e,n,t,r){var a=e._dbSchema;t.objectStoreNames.contains("$meta")&&!a.$meta&&(a.$meta=kt("$meta",fr("")[0],[]),e._storeNames.push("$meta"));var i=e._createTransaction("readwrite",e._storeNames,a);i.create(t),i._completion.catch(r);var o=i._reject.bind(i),u=T.transless||T;Ae(function(){return T.trans=i,T.transless=u,n!==0?(Vn(e,t),f=n,((c=i).storeNames.includes("$meta")?c.table("$meta").get("version").then(function(p){return p??f}):E.resolve(f)).then(function(p){return m=p,l=i,h=t,y=[],p=(s=e)._versions,d=s._dbSchema=Wn(0,s.idbdb,h),(p=p.filter(function(v){return v._cfg.version>=m})).length!==0?(p.forEach(function(v){y.push(function(){var g=d,b=v._cfg.dbschema;Yn(s,g,h),Yn(s,b,h),d=s._dbSchema=b;var w=Ot(g,b);w.add.forEach(function(S){At(h,S[0],S[1].primKey,S[1].indexes)}),w.change.forEach(function(S){if(S.recreate)throw new D.Upgrade("Not yet support for changing primary key");var O=h.objectStore(S.name);S.add.forEach(function(K){return zn(O,K)}),S.change.forEach(function(K){O.deleteIndex(K.name),zn(O,K)}),S.del.forEach(function(K){return O.deleteIndex(K)})});var x=v._cfg.contentUpgrade;if(x&&v._cfg.version>m){Vn(s,h),l._memoizedTables={};var A=Pn(b);w.del.forEach(function(S){A[S]=g[S]}),Pt(s,[s.Transaction.prototype]),Un(s,[s.Transaction.prototype],U(A),A),l.schema=A;var k,I=qe(x);return I&&Ze(),w=E.follow(function(){var S;(k=x(l))&&I&&(S=Se.bind(null,null),k.then(S,S))}),k&&typeof k.then=="function"?E.resolve(k):w.then(function(){return k})}}),y.push(function(g){var b,w,x=v._cfg.dbschema;b=x,w=g,[].slice.call(w.db.objectStoreNames).forEach(function(A){return b[A]==null&&w.db.deleteObjectStore(A)}),Pt(s,[s.Transaction.prototype]),Un(s,[s.Transaction.prototype],s._storeNames,s._dbSchema),l.schema=s._dbSchema}),y.push(function(g){s.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(s.idbdb.version/10)===v._cfg.version?(s.idbdb.deleteObjectStore("$meta"),delete s._dbSchema.$meta,s._storeNames=s._storeNames.filter(function(b){return b!=="$meta"})):g.objectStore("$meta").put(v._cfg.version,"version"))})}),function v(){return y.length?E.resolve(y.shift()(l.idbtrans)).then(v):E.resolve()}().then(function(){lr(d,h)})):E.resolve();var s,m,l,h,y,d}).catch(o)):(U(a).forEach(function(p){At(t,p,a[p].primKey,a[p].indexes)}),Vn(e,t),void E.follow(function(){return e.on.populate.fire(i)}).catch(o));var c,f})}function Xr(e,n){lr(e._dbSchema,n),n.db.version%10!=0||n.objectStoreNames.contains("$meta")||n.db.createObjectStore("$meta").add(Math.ceil(n.db.version/10-1),"version");var t=Wn(0,e.idbdb,n);Yn(e,e._dbSchema,n);for(var r=0,a=Ot(t,e._dbSchema).change;r<a.length;r++){var i=function(o){if(o.change.length||o.recreate)return console.warn("Unable to patch indexes of table ".concat(o.name," because it has changes on the type of index or primary key.")),{value:void 0};var u=n.objectStore(o.name);o.add.forEach(function(c){ge&&console.debug("Dexie upgrade patch: Creating missing index ".concat(o.name,".").concat(c.src)),zn(u,c)})}(a[r]);if(typeof i=="object")return i.value}}function Ot(e,n){var t,r={del:[],add:[],change:[]};for(t in e)n[t]||r.del.push(t);for(t in n){var a=e[t],i=n[t];if(a){var o={name:t,def:i,recreate:!1,del:[],add:[],change:[]};if(""+(a.primKey.keyPath||"")!=""+(i.primKey.keyPath||"")||a.primKey.auto!==i.primKey.auto)o.recreate=!0,r.change.push(o);else{var u=a.idxByName,c=i.idxByName,f=void 0;for(f in u)c[f]||o.del.push(f);for(f in c){var p=u[f],s=c[f];p?p.src!==s.src&&o.change.push(s):o.add.push(s)}(0<o.del.length||0<o.add.length||0<o.change.length)&&r.change.push(o)}}else r.add.push([t,i])}return r}function At(e,n,t,r){var a=e.db.createObjectStore(n,t.keyPath?{keyPath:t.keyPath,autoIncrement:t.auto}:{autoIncrement:t.auto});return r.forEach(function(i){return zn(a,i)}),a}function lr(e,n){U(e).forEach(function(t){n.db.objectStoreNames.contains(t)||(ge&&console.debug("Dexie: Creating missing table",t),At(n,t,e[t].primKey,e[t].indexes))})}function zn(e,n){e.createIndex(n.name,n.keyPath,{unique:n.unique,multiEntry:n.multi})}function Wn(e,n,t){var r={};return $e(n.objectStoreNames,0).forEach(function(a){for(var i=t.objectStore(a),o=xt(sr(f=i.keyPath),f||"",!0,!1,!!i.autoIncrement,f&&typeof f!="string",!0),u=[],c=0;c<i.indexNames.length;++c){var p=i.index(i.indexNames[c]),f=p.keyPath,p=xt(p.name,f,!!p.unique,!!p.multiEntry,!1,f&&typeof f!="string",!1);u.push(p)}r[a]=kt(a,o,u)}),r}function Yn(e,n,t){for(var r=t.db.objectStoreNames,a=0;a<r.length;++a){var i=r[a],o=t.objectStore(i);e._hasGetAll="getAll"in o;for(var u=0;u<o.indexNames.length;++u){var c=o.indexNames[u],f=o.index(c).keyPath,p=typeof f=="string"?f:"["+$e(f).join("+")+"]";!n[i]||(f=n[i].idxByName[p])&&(f.name=c,delete n[i].idxByName[p],n[i].idxByName[c]=f)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&Q.WorkerGlobalScope&&Q instanceof Q.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function fr(e){return e.split(",").map(function(n,t){var r=(n=n.trim()).replace(/([&*]|\+\+)/g,""),a=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return xt(r,a||null,/\&/.test(n),/\*/.test(n),/\+\+/.test(n),z(a),t===0)})}var Hr=($n.prototype._parseStoresSpec=function(e,n){U(e).forEach(function(t){if(e[t]!==null){var r=fr(e[t]),a=r.shift();if(a.unique=!0,a.multi)throw new D.Schema("Primary key cannot be multi-valued");r.forEach(function(i){if(i.auto)throw new D.Schema("Only primary key can be marked as autoIncrement (++)");if(!i.keyPath)throw new D.Schema("Index must have a name and cannot be an empty string")}),n[t]=kt(t,a,r)}})},$n.prototype.stores=function(t){var n=this.db;this._cfg.storesSource=this._cfg.storesSource?J(this._cfg.storesSource,t):t;var t=n._versions,r={},a={};return t.forEach(function(i){J(r,i._cfg.storesSource),a=i._cfg.dbschema={},i._parseStoresSpec(r,a)}),n._dbSchema=a,Pt(n,[n._allTables,n,n.Transaction.prototype]),Un(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],U(a),a),n._storeNames=U(a),this},$n.prototype.upgrade=function(e){return this._cfg.contentUpgrade=ut(this._cfg.contentUpgrade||W,e),this},$n);function $n(){}function St(e,n){var t=e._dbNamesDB;return t||(t=e._dbNamesDB=new ke(Bn,{addons:[],indexedDB:e,IDBKeyRange:n})).version(1).stores({dbnames:"name"}),t.table("dbnames")}function Et(e){return e&&typeof e.databases=="function"}function Kt(e){return Ae(function(){return T.letThrough=!0,e()})}function Ct(e){return!("from"in e)}var te=function(e,n){if(!this){var t=new te;return e&&"d"in e&&J(t,e),t}J(this,arguments.length?{d:1,from:e,to:1<arguments.length?n:e}:{d:0})};function wn(e,n,t){var r=N(n,t);if(!isNaN(r)){if(0<r)throw RangeError();if(Ct(e))return J(e,{from:n,to:t,d:1});var a=e.l,r=e.r;if(N(t,e.from)<0)return a?wn(a,n,t):e.l={from:n,to:t,d:1,l:null,r:null},hr(e);if(0<N(n,e.to))return r?wn(r,n,t):e.r={from:n,to:t,d:1,l:null,r:null},hr(e);N(n,e.from)<0&&(e.from=n,e.l=null,e.d=r?r.d+1:1),0<N(t,e.to)&&(e.to=t,e.r=null,e.d=e.l?e.l.d+1:1),t=!e.r,a&&!e.l&&_n(e,a),r&&t&&_n(e,r)}}function _n(e,n){Ct(n)||function t(r,c){var i=c.from,o=c.to,u=c.l,c=c.r;wn(r,i,o),u&&t(r,u),c&&t(r,c)}(e,n)}function dr(e,n){var t=Qn(n),r=t.next();if(r.done)return!1;for(var a=r.value,i=Qn(e),o=i.next(a.from),u=o.value;!r.done&&!o.done;){if(N(u.from,a.to)<=0&&0<=N(u.to,a.from))return!0;N(a.from,u.from)<0?a=(r=t.next(u.from)).value:u=(o=i.next(a.from)).value}return!1}function Qn(e){var n=Ct(e)?null:{s:0,n:e};return{next:function(t){for(var r=0<arguments.length;n;)switch(n.s){case 0:if(n.s=1,r)for(;n.n.l&&N(t,n.n.from)<0;)n={up:n,n:n.n.l,s:1};else for(;n.n.l;)n={up:n,n:n.n.l,s:1};case 1:if(n.s=2,!r||N(t,n.n.to)<=0)return{value:n.n,done:!1};case 2:if(n.n.r){n.s=3,n={up:n,n:n.n.r,s:0};continue}case 3:n=n.up}return{done:!0}}}}function hr(e){var n,t,r=(((n=e.r)===null||n===void 0?void 0:n.d)||0)-(((t=e.l)===null||t===void 0?void 0:t.d)||0),a=1<r?"r":r<-1?"l":"";a&&(n=a=="r"?"l":"r",t=j({},e),r=e[a],e.from=r.from,e.to=r.to,e[a]=r[a],t[a]=r[n],(e[n]=t).d=pr(t)),e.d=pr(e)}function pr(t){var n=t.r,t=t.l;return(n?t?Math.max(n.d,t.d):n.d:t?t.d:0)+1}function Gn(e,n){return U(n).forEach(function(t){e[t]?_n(e[t],n[t]):e[t]=function r(a){var i,o,u={};for(i in a)L(a,i)&&(o=a[i],u[i]=!o||typeof o!="object"||On.has(o.constructor)?o:r(o));return u}(n[t])}),e}function Tt(e,n){return e.all||n.all||Object.keys(e).some(function(t){return n[t]&&dr(n[t],e[t])})}pe(te.prototype,((de={add:function(e){return _n(this,e),this},addKey:function(e){return wn(this,e,e),this},addKeys:function(e){var n=this;return e.forEach(function(t){return wn(n,t,t)}),this},hasKey:function(e){var n=Qn(this).next(e).value;return n&&N(n.from,e)<=0&&0<=N(n.to,e)}})[je]=function(){return Qn(this)},de));var ze={},Dt={},jt=!1;function Xn(e){Gn(Dt,e),jt||(jt=!0,setTimeout(function(){jt=!1,qt(Dt,!(Dt={}))},0))}function qt(e,n){n===void 0&&(n=!1);var t=new Set;if(e.all)for(var r=0,a=Object.values(ze);r<a.length;r++)yr(o=a[r],e,t,n);else for(var i in e){var o,u=/^idb\:\/\/(.*)\/(.*)\//.exec(i);u&&(i=u[1],u=u[2],(o=ze["idb://".concat(i,"/").concat(u)])&&yr(o,e,t,n))}t.forEach(function(c){return c()})}function yr(e,n,t,r){for(var a=[],i=0,o=Object.entries(e.queries.query);i<o.length;i++){for(var u=o[i],c=u[0],f=[],p=0,s=u[1];p<s.length;p++){var m=s[p];Tt(n,m.obsSet)?m.subscribers.forEach(function(d){return t.add(d)}):r&&f.push(m)}r&&a.push([c,f])}if(r)for(var l=0,h=a;l<h.length;l++){var y=h[l],c=y[0],f=y[1];e.queries.query[c]=f}}function Jr(e){var n=e._state,t=e._deps.indexedDB;if(n.isBeingOpened||e.idbdb)return n.dbReadyPromise.then(function(){return n.dbOpenError?G(n.dbOpenError):e});n.isBeingOpened=!0,n.dbOpenError=null,n.openComplete=!1;var r=n.openCanceller,a=Math.round(10*e.verno),i=!1;function o(){if(n.openCanceller!==r)throw new D.DatabaseClosed("db.open() was cancelled")}function u(){return new E(function(m,l){if(o(),!t)throw new D.MissingAPI;var h=e.name,y=n.autoSchema||!a?t.open(h):t.open(h,a);if(!y)throw new D.MissingAPI;y.onerror=be(l),y.onblocked=$(e._fireOnBlocked),y.onupgradeneeded=$(function(d){var v;p=y.transaction,n.autoSchema&&!e._options.allowEmptyDB?(y.onerror=mn,p.abort(),y.result.close(),(v=t.deleteDatabase(h)).onsuccess=v.onerror=$(function(){l(new D.NoSuchDatabase("Database ".concat(h," doesnt exist")))})):(p.onerror=be(l),d=d.oldVersion>Math.pow(2,62)?0:d.oldVersion,s=d<1,e.idbdb=y.result,i&&Xr(e,p),Gr(e,d/10,p,l))},l),y.onsuccess=$(function(){p=null;var d,v,g,b,w,x=e.idbdb=y.result,A=$e(x.objectStoreNames);if(0<A.length)try{var k=x.transaction((b=A).length===1?b[0]:b,"readonly");if(n.autoSchema)v=x,g=k,(d=e).verno=v.version/10,g=d._dbSchema=Wn(0,v,g),d._storeNames=$e(v.objectStoreNames,0),Un(d,[d._allTables],U(g),g);else if(Yn(e,e._dbSchema,k),((w=Ot(Wn(0,(w=e).idbdb,k),w._dbSchema)).add.length||w.change.some(function(I){return I.add.length||I.change.length}))&&!i)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),x.close(),a=x.version+1,i=!0,m(u());Vn(e,k)}catch{}en.push(e),x.onversionchange=$(function(I){n.vcFired=!0,e.on("versionchange").fire(I)}),x.onclose=$(function(I){e.on("close").fire(I)}),s&&(w=e._deps,k=h,x=w.indexedDB,w=w.IDBKeyRange,Et(x)||k===Bn||St(x,w).put({name:k}).catch(W)),m()},l)}).catch(function(m){switch(m==null?void 0:m.name){case"UnknownError":if(0<n.PR1398_maxLoop)return n.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),u();break;case"VersionError":if(0<a)return a=0,u()}return E.reject(m)})}var c,f=n.dbReadyResolve,p=null,s=!1;return E.race([r,(typeof navigator>"u"?E.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(m){function l(){return indexedDB.databases().finally(m)}c=setInterval(l,100),l()}).finally(function(){return clearInterval(c)}):Promise.resolve()).then(u)]).then(function(){return o(),n.onReadyBeingFired=[],E.resolve(Kt(function(){return e.on.ready.fire(e.vip)})).then(function m(){if(0<n.onReadyBeingFired.length){var l=n.onReadyBeingFired.reduce(ut,W);return n.onReadyBeingFired=[],E.resolve(Kt(function(){return l(e.vip)})).then(m)}})}).finally(function(){n.openCanceller===r&&(n.onReadyBeingFired=null,n.isBeingOpened=!1)}).catch(function(m){n.dbOpenError=m;try{p&&p.abort()}catch{}return r===n.openCanceller&&e._close(),G(m)}).finally(function(){n.openComplete=!0,f()}).then(function(){var m;return s&&(m={},e.tables.forEach(function(l){l.schema.indexes.forEach(function(h){h.name&&(m["idb://".concat(e.name,"/").concat(l.name,"/").concat(h.name)]=new te(-1/0,[[[]]]))}),m["idb://".concat(e.name,"/").concat(l.name,"/")]=m["idb://".concat(e.name,"/").concat(l.name,"/:dels")]=new te(-1/0,[[[]]])}),Ce(vn).fire(m),qt(m,!0)),e})}function Rt(e){function n(i){return e.next(i)}var t=a(n),r=a(function(i){return e.throw(i)});function a(i){return function(c){var u=i(c),c=u.value;return u.done?c:c&&typeof c.then=="function"?c.then(t,r):z(c)?Promise.all(c).then(t,r):t(c)}}return a(n)()}function Hn(e,n,t){for(var r=z(e)?e.slice():[e],a=0;a<t;++a)r.push(n);return r}var Zr={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return j(j({},e),{table:function(n){var t=e.table(n),r=t.schema,a={},i=[];function o(s,m,l){var h=bn(s),y=a[h]=a[h]||[],d=s==null?0:typeof s=="string"?1:s.length,v=0<m,v=j(j({},l),{name:v?"".concat(h,"(virtual-from:").concat(l.name,")"):l.name,lowLevelIndex:l,isVirtual:v,keyTail:m,keyLength:d,extractKey:It(s),unique:!v&&l.unique});return y.push(v),v.isPrimaryKey||i.push(v),1<d&&o(d===2?s[0]:s.slice(0,d-1),m+1,l),y.sort(function(g,b){return g.keyTail-b.keyTail}),v}n=o(r.primaryKey.keyPath,0,r.primaryKey),a[":id"]=[n];for(var u=0,c=r.indexes;u<c.length;u++){var f=c[u];o(f.keyPath,0,f)}function p(s){var m,l=s.query.index;return l.isVirtual?j(j({},s),{query:{index:l.lowLevelIndex,range:(m=s.query.range,l=l.keyTail,{type:m.type===1?2:m.type,lower:Hn(m.lower,m.lowerOpen?e.MAX_KEY:e.MIN_KEY,l),lowerOpen:!0,upper:Hn(m.upper,m.upperOpen?e.MIN_KEY:e.MAX_KEY,l),upperOpen:!0})}}):s}return j(j({},t),{schema:j(j({},r),{primaryKey:n,indexes:i,getIndexByKeyPath:function(s){return(s=a[bn(s)])&&s[0]}}),count:function(s){return t.count(p(s))},query:function(s){return t.query(p(s))},openCursor:function(s){var m=s.query.index,l=m.keyTail,h=m.isVirtual,y=m.keyLength;return h?t.openCursor(p(s)).then(function(v){return v&&d(v)}):t.openCursor(s);function d(v){return Object.create(v,{continue:{value:function(g){g!=null?v.continue(Hn(g,s.reverse?e.MAX_KEY:e.MIN_KEY,l)):s.unique?v.continue(v.key.slice(0,y).concat(s.reverse?e.MIN_KEY:e.MAX_KEY,l)):v.continue()}},continuePrimaryKey:{value:function(g,b){v.continuePrimaryKey(Hn(g,e.MAX_KEY,l),b)}},primaryKey:{get:function(){return v.primaryKey}},key:{get:function(){var g=v.key;return y===1?g[0]:g.slice(0,y)}},value:{get:function(){return v.value}}})}}})}})}};function Bt(e,n,t,r){return t=t||{},r=r||"",U(e).forEach(function(a){var i,o,u;L(n,a)?(i=e[a],o=n[a],typeof i=="object"&&typeof o=="object"&&i&&o?(u=on(i))!==on(o)?t[r+a]=n[a]:u==="Object"?Bt(i,o,t,r+a+"."):i!==o&&(t[r+a]=n[a]):i!==o&&(t[r+a]=n[a])):t[r+a]=void 0}),U(n).forEach(function(a){L(e,a)||(t[r+a]=n[a])}),t}function Ft(e,n){return n.type==="delete"?n.keys:n.keys||n.values.map(e.extractKey)}var ea={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return j(j({},e),{table:function(n){var t=e.table(n),r=t.schema.primaryKey;return j(j({},t),{mutate:function(a){var i=T.trans,o=i.table(n).hook,u=o.deleting,c=o.creating,f=o.updating;switch(a.type){case"add":if(c.fire===W)break;return i._promise("readwrite",function(){return p(a)},!0);case"put":if(c.fire===W&&f.fire===W)break;return i._promise("readwrite",function(){return p(a)},!0);case"delete":if(u.fire===W)break;return i._promise("readwrite",function(){return p(a)},!0);case"deleteRange":if(u.fire===W)break;return i._promise("readwrite",function(){return function s(m,l,h){return t.query({trans:m,values:!1,query:{index:r,range:l},limit:h}).then(function(y){var d=y.result;return p({type:"delete",keys:d,trans:m}).then(function(v){return 0<v.numFailures?Promise.reject(v.failures[0]):d.length<h?{failures:[],numFailures:0,lastResult:void 0}:s(m,j(j({},l),{lower:d[d.length-1],lowerOpen:!0}),h)})})}(a.trans,a.range,1e4)},!0)}return t.mutate(a);function p(s){var m,l,h,y=T.trans,d=s.keys||Ft(r,s);if(!d)throw new Error("Keys missing");return(s=s.type==="add"||s.type==="put"?j(j({},s),{keys:d}):j({},s)).type!=="delete"&&(s.values=oe([],s.values)),s.keys&&(s.keys=oe([],s.keys)),m=t,h=d,((l=s).type==="add"?Promise.resolve([]):m.getMany({trans:l.trans,keys:h,cache:"immutable"})).then(function(v){var g=d.map(function(b,w){var x,A,k,I=v[w],S={onerror:null,onsuccess:null};return s.type==="delete"?u.fire.call(S,b,I,y):s.type==="add"||I===void 0?(x=c.fire.call(S,b,s.values[w],y),b==null&&x!=null&&(s.keys[w]=b=x,r.outbound||ue(s.values[w],r.keyPath,b))):(x=Bt(I,s.values[w]),(A=f.fire.call(S,x,b,I,y))&&(k=s.values[w],Object.keys(A).forEach(function(O){L(k,O)?k[O]=A[O]:ue(k,O,A[O])}))),S});return t.mutate(s).then(function(b){for(var w=b.failures,x=b.results,A=b.numFailures,b=b.lastResult,k=0;k<d.length;++k){var I=(x||d)[k],S=g[k];I==null?S.onerror&&S.onerror(w[k]):S.onsuccess&&S.onsuccess(s.type==="put"&&v[k]?s.values[k]:I)}return{failures:w,results:x,numFailures:A,lastResult:b}}).catch(function(b){return g.forEach(function(w){return w.onerror&&w.onerror(b)}),Promise.reject(b)})})}}})}})}};function mr(e,n,t){try{if(!n||n.keys.length<e.length)return null;for(var r=[],a=0,i=0;a<n.keys.length&&i<e.length;++a)N(n.keys[a],e[i])===0&&(r.push(t?_e(n.values[a]):n.values[a]),++i);return r.length===e.length?r:null}catch{return null}}var na={stack:"dbcore",level:-1,create:function(e){return{table:function(n){var t=e.table(n);return j(j({},t),{getMany:function(r){if(!r.cache)return t.getMany(r);var a=mr(r.keys,r.trans._cache,r.cache==="clone");return a?E.resolve(a):t.getMany(r).then(function(i){return r.trans._cache={keys:r.keys,values:r.cache==="clone"?_e(i):i},i})},mutate:function(r){return r.type!=="add"&&(r.trans._cache=null),t.mutate(r)}})}}}};function vr(e,n){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!n.schema.primaryKey.outbound}function gr(e,n){switch(e){case"query":return n.values&&!n.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var ta={stack:"dbcore",level:0,name:"Observability",create:function(e){var n=e.schema.name,t=new te(e.MIN_KEY,e.MAX_KEY);return j(j({},e),{transaction:function(r,a,i){if(T.subscr&&a!=="readonly")throw new D.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(T.querier));return e.transaction(r,a,i)},table:function(r){var a=e.table(r),i=a.schema,o=i.primaryKey,s=i.indexes,u=o.extractKey,c=o.outbound,f=o.autoIncrement&&s.filter(function(l){return l.compound&&l.keyPath.includes(o.keyPath)}),p=j(j({},a),{mutate:function(l){function h(O){return O="idb://".concat(n,"/").concat(r,"/").concat(O),b[O]||(b[O]=new te)}var y,d,v,g=l.trans,b=l.mutatedParts||(l.mutatedParts={}),w=h(""),x=h(":dels"),A=l.type,S=l.type==="deleteRange"?[l.range]:l.type==="delete"?[l.keys]:l.values.length<50?[Ft(o,l).filter(function(O){return O}),l.values]:[],k=S[0],I=S[1],S=l.trans._cache;return z(k)?(w.addKeys(k),(S=A==="delete"||k.length===I.length?mr(k,S):null)||x.addKeys(k),(S||I)&&(y=h,d=S,v=I,i.indexes.forEach(function(O){var K=y(O.name||"");function B(M){return M!=null?O.extractKey(M):null}function F(M){return O.multiEntry&&z(M)?M.forEach(function(le){return K.addKey(le)}):K.addKey(M)}(d||v).forEach(function(M,re){var R=d&&B(d[re]),re=v&&B(v[re]);N(R,re)!==0&&(R!=null&&F(R),re!=null&&F(re))})}))):k?(I={from:(I=k.lower)!==null&&I!==void 0?I:e.MIN_KEY,to:(I=k.upper)!==null&&I!==void 0?I:e.MAX_KEY},x.add(I),w.add(I)):(w.add(t),x.add(t),i.indexes.forEach(function(O){return h(O.name).add(t)})),a.mutate(l).then(function(O){return!k||l.type!=="add"&&l.type!=="put"||(w.addKeys(O.results),f&&f.forEach(function(K){for(var B=l.values.map(function(R){return K.extractKey(R)}),F=K.keyPath.findIndex(function(R){return R===o.keyPath}),M=0,le=O.results.length;M<le;++M)B[M][F]=O.results[M];h(K.name).addKeys(B)})),g.mutatedParts=Gn(g.mutatedParts||{},b),O})}}),s=function(h){var y=h.query,h=y.index,y=y.range;return[h,new te((h=y.lower)!==null&&h!==void 0?h:e.MIN_KEY,(y=y.upper)!==null&&y!==void 0?y:e.MAX_KEY)]},m={get:function(l){return[o,new te(l.key)]},getMany:function(l){return[o,new te().addKeys(l.keys)]},count:s,query:s,openCursor:s};return U(m).forEach(function(l){p[l]=function(h){var y=T.subscr,d=!!y,v=vr(T,a)&&gr(l,h)?h.obsSet={}:y;if(d){var g=function(I){return I="idb://".concat(n,"/").concat(r,"/").concat(I),v[I]||(v[I]=new te)},b=g(""),w=g(":dels"),y=m[l](h),d=y[0],y=y[1];if((l==="query"&&d.isPrimaryKey&&!h.values?w:g(d.name||"")).add(y),!d.isPrimaryKey){if(l!=="count"){var x=l==="query"&&c&&h.values&&a.query(j(j({},h),{values:!1}));return a[l].apply(this,arguments).then(function(I){if(l==="query"){if(c&&h.values)return x.then(function(B){return B=B.result,b.addKeys(B),I});var S=h.values?I.result.map(u):I.result;(h.values?b:w).addKeys(S)}else if(l==="openCursor"){var O=I,K=h.values;return O&&Object.create(O,{key:{get:function(){return w.addKey(O.primaryKey),O.key}},primaryKey:{get:function(){var B=O.primaryKey;return w.addKey(B),B}},value:{get:function(){return K&&b.addKey(O.primaryKey),O.value}}})}return I})}w.add(t)}}return a[l].apply(this,arguments)}}),p}})}};function br(e,n,t){if(t.numFailures===0)return n;if(n.type==="deleteRange")return null;var r=n.keys?n.keys.length:"values"in n&&n.values?n.values.length:1;return t.numFailures===r?null:(n=j({},n),z(n.keys)&&(n.keys=n.keys.filter(function(a,i){return!(i in t.failures)})),"values"in n&&z(n.values)&&(n.values=n.values.filter(function(a,i){return!(i in t.failures)})),n)}function Mt(e,n){return t=e,((r=n).lower===void 0||(r.lowerOpen?0<N(t,r.lower):0<=N(t,r.lower)))&&(e=e,(n=n).upper===void 0||(n.upperOpen?N(e,n.upper)<0:N(e,n.upper)<=0));var t,r}function wr(e,n,m,r,a,i){if(!m||m.length===0)return e;var o=n.query.index,u=o.multiEntry,c=n.query.range,f=r.schema.primaryKey.extractKey,p=o.extractKey,s=(o.lowLevelIndex||o).extractKey,m=m.reduce(function(l,h){var y=l,d=[];if(h.type==="add"||h.type==="put")for(var v=new te,g=h.values.length-1;0<=g;--g){var b,w=h.values[g],x=f(w);v.hasKey(x)||(b=p(w),(u&&z(b)?b.some(function(O){return Mt(O,c)}):Mt(b,c))&&(v.addKey(x),d.push(w)))}switch(h.type){case"add":var A=new te().addKeys(n.values?l.map(function(K){return f(K)}):l),y=l.concat(n.values?d.filter(function(K){return K=f(K),!A.hasKey(K)&&(A.addKey(K),!0)}):d.map(function(K){return f(K)}).filter(function(K){return!A.hasKey(K)&&(A.addKey(K),!0)}));break;case"put":var k=new te().addKeys(h.values.map(function(K){return f(K)}));y=l.filter(function(K){return!k.hasKey(n.values?f(K):K)}).concat(n.values?d:d.map(function(K){return f(K)}));break;case"delete":var I=new te().addKeys(h.keys);y=l.filter(function(K){return!I.hasKey(n.values?f(K):K)});break;case"deleteRange":var S=h.range;y=l.filter(function(K){return!Mt(f(K),S)})}return y},e);return m===e?e:(m.sort(function(l,h){return N(s(l),s(h))||N(f(l),f(h))}),n.limit&&n.limit<1/0&&(m.length>n.limit?m.length=n.limit:e.length===n.limit&&m.length<n.limit&&(a.dirty=!0)),i?Object.freeze(m):m)}function _r(e,n){return N(e.lower,n.lower)===0&&N(e.upper,n.upper)===0&&!!e.lowerOpen==!!n.lowerOpen&&!!e.upperOpen==!!n.upperOpen}function ra(e,n){return function(t,r,a,i){if(t===void 0)return r!==void 0?-1:0;if(r===void 0)return 1;if((r=N(t,r))===0){if(a&&i)return 0;if(a)return 1;if(i)return-1}return r}(e.lower,n.lower,e.lowerOpen,n.lowerOpen)<=0&&0<=function(t,r,a,i){if(t===void 0)return r!==void 0?1:0;if(r===void 0)return-1;if((r=N(t,r))===0){if(a&&i)return 0;if(a)return-1;if(i)return 1}return r}(e.upper,n.upper,e.upperOpen,n.upperOpen)}function aa(e,n,t,r){e.subscribers.add(t),r.addEventListener("abort",function(){var a,i;e.subscribers.delete(t),e.subscribers.size===0&&(a=e,i=n,setTimeout(function(){a.subscribers.size===0&&_(i,a)},3e3))})}var ia={stack:"dbcore",level:0,name:"Cache",create:function(e){var n=e.schema.name;return j(j({},e),{transaction:function(t,r,a){var i,o,u=e.transaction(t,r,a);return r==="readwrite"&&(o=(i=new AbortController).signal,a=function(c){return function(){if(i.abort(),r==="readwrite"){for(var f=new Set,p=0,s=t;p<s.length;p++){var m=s[p],l=ze["idb://".concat(n,"/").concat(m)];if(l){var h=e.table(m),y=l.optimisticOps.filter(function(K){return K.trans===u});if(u._explicit&&c&&u.mutatedParts)for(var d=0,v=Object.values(l.queries.query);d<v.length;d++)for(var g=0,b=(A=v[d]).slice();g<b.length;g++)Tt((k=b[g]).obsSet,u.mutatedParts)&&(_(A,k),k.subscribers.forEach(function(K){return f.add(K)}));else if(0<y.length){l.optimisticOps=l.optimisticOps.filter(function(K){return K.trans!==u});for(var w=0,x=Object.values(l.queries.query);w<x.length;w++)for(var A,k,I,S=0,O=(A=x[w]).slice();S<O.length;S++)(k=O[S]).res!=null&&u.mutatedParts&&(c&&!k.dirty?(I=Object.isFrozen(k.res),I=wr(k.res,k.req,y,h,k,I),k.dirty?(_(A,k),k.subscribers.forEach(function(K){return f.add(K)})):I!==k.res&&(k.res=I,k.promise=E.resolve({result:I}))):(k.dirty&&_(A,k),k.subscribers.forEach(function(K){return f.add(K)})))}}}f.forEach(function(K){return K()})}}},u.addEventListener("abort",a(!1),{signal:o}),u.addEventListener("error",a(!1),{signal:o}),u.addEventListener("complete",a(!0),{signal:o})),u},table:function(t){var r=e.table(t),a=r.schema.primaryKey;return j(j({},r),{mutate:function(i){var o=T.trans;if(a.outbound||o.db._options.cache==="disabled"||o.explicit||o.idbtrans.mode!=="readwrite")return r.mutate(i);var u=ze["idb://".concat(n,"/").concat(t)];return u?(o=r.mutate(i),i.type!=="add"&&i.type!=="put"||!(50<=i.values.length||Ft(a,i).some(function(c){return c==null}))?(u.optimisticOps.push(i),i.mutatedParts&&Xn(i.mutatedParts),o.then(function(c){0<c.numFailures&&(_(u.optimisticOps,i),(c=br(0,i,c))&&u.optimisticOps.push(c),i.mutatedParts&&Xn(i.mutatedParts))}),o.catch(function(){_(u.optimisticOps,i),i.mutatedParts&&Xn(i.mutatedParts)})):o.then(function(c){var f=br(0,j(j({},i),{values:i.values.map(function(p,s){var m;return c.failures[s]?p:(p=(m=a.keyPath)!==null&&m!==void 0&&m.includes(".")?_e(p):j({},p),ue(p,a.keyPath,c.results[s]),p)})}),c);u.optimisticOps.push(f),queueMicrotask(function(){return i.mutatedParts&&Xn(i.mutatedParts)})}),o):r.mutate(i)},query:function(i){if(!vr(T,r)||!gr("query",i))return r.query(i);var o=((f=T.trans)===null||f===void 0?void 0:f.db._options.cache)==="immutable",s=T,u=s.requery,c=s.signal,f=function(h,y,d,v){var g=ze["idb://".concat(h,"/").concat(y)];if(!g)return[];if(!(y=g.queries[d]))return[null,!1,g,null];var b=y[(v.query?v.query.index.name:null)||""];if(!b)return[null,!1,g,null];switch(d){case"query":var w=b.find(function(x){return x.req.limit===v.limit&&x.req.values===v.values&&_r(x.req.query.range,v.query.range)});return w?[w,!0,g,b]:[b.find(function(x){return("limit"in x.req?x.req.limit:1/0)>=v.limit&&(!v.values||x.req.values)&&ra(x.req.query.range,v.query.range)}),!1,g,b];case"count":return w=b.find(function(x){return _r(x.req.query.range,v.query.range)}),[w,!!w,g,b]}}(n,t,"query",i),p=f[0],s=f[1],m=f[2],l=f[3];return p&&s?p.obsSet=i.obsSet:(s=r.query(i).then(function(h){var y=h.result;if(p&&(p.res=y),o){for(var d=0,v=y.length;d<v;++d)Object.freeze(y[d]);Object.freeze(y)}else h.result=_e(y);return h}).catch(function(h){return l&&p&&_(l,p),Promise.reject(h)}),p={obsSet:i.obsSet,promise:s,subscribers:new Set,type:"query",req:i,dirty:!1},l?l.push(p):(l=[p],(m=m||(ze["idb://".concat(n,"/").concat(t)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[i.query.index.name||""]=l)),aa(p,l,u,c),p.promise.then(function(h){return{result:wr(h.result,i,m==null?void 0:m.optimisticOps,r,p,o)}})}})}})}};function Jn(e,n){return new Proxy(e,{get:function(t,r,a){return r==="db"?n:Reflect.get(t,r,a)}})}var ke=(X.prototype.version=function(e){if(isNaN(e)||e<.1)throw new D.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new D.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var n=this._versions,t=n.filter(function(r){return r._cfg.version===e})[0];return t||(t=new this.Version(e),n.push(t),n.sort(Qr),t.stores({}),this._state.autoSchema=!1,t)},X.prototype._whenReady=function(e){var n=this;return this.idbdb&&(this._state.openComplete||T.letThrough||this._vip)?e():new E(function(t,r){if(n._state.openComplete)return r(new D.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._state.autoOpen)return void r(new D.DatabaseClosed);n.open().catch(W)}n._state.dbReadyPromise.then(t,r)}).then(e)},X.prototype.use=function(e){var n=e.stack,t=e.create,r=e.level,a=e.name;return a&&this.unuse({stack:n,name:a}),e=this._middlewares[n]||(this._middlewares[n]=[]),e.push({stack:n,create:t,level:r??10,name:a}),e.sort(function(i,o){return i.level-o.level}),this},X.prototype.unuse=function(e){var n=e.stack,t=e.name,r=e.create;return n&&this._middlewares[n]&&(this._middlewares[n]=this._middlewares[n].filter(function(a){return r?a.create!==r:!!t&&a.name!==t})),this},X.prototype.open=function(){var e=this;return Le(Oe,function(){return Jr(e)})},X.prototype._close=function(){var e=this._state,n=en.indexOf(this);if(0<=n&&en.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new E(function(t){e.dbReadyResolve=t}),e.openCanceller=new E(function(t,r){e.cancelOpen=r}))},X.prototype.close=function(t){var n=(t===void 0?{disableAutoOpen:!0}:t).disableAutoOpen,t=this._state;n?(t.isBeingOpened&&t.cancelOpen(new D.DatabaseClosed),this._close(),t.autoOpen=!1,t.dbOpenError=new D.DatabaseClosed):(this._close(),t.autoOpen=this._options.autoOpen||t.isBeingOpened,t.openComplete=!1,t.dbOpenError=null)},X.prototype.delete=function(e){var n=this;e===void 0&&(e={disableAutoOpen:!0});var t=0<arguments.length&&typeof arguments[0]!="object",r=this._state;return new E(function(a,i){function o(){n.close(e);var u=n._deps.indexedDB.deleteDatabase(n.name);u.onsuccess=$(function(){var c,f,p;c=n._deps,f=n.name,p=c.indexedDB,c=c.IDBKeyRange,Et(p)||f===Bn||St(p,c).delete(f).catch(W),a()}),u.onerror=be(i),u.onblocked=n._fireOnBlocked}if(t)throw new D.InvalidArgument("Invalid closeOptions argument to db.delete()");r.isBeingOpened?r.dbReadyPromise.then(o):o()})},X.prototype.backendDB=function(){return this.idbdb},X.prototype.isOpen=function(){return this.idbdb!==null},X.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},X.prototype.hasFailed=function(){return this._state.dbOpenError!==null},X.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(X.prototype,"tables",{get:function(){var e=this;return U(this._allTables).map(function(n){return e._allTables[n]})},enumerable:!1,configurable:!0}),X.prototype.transaction=function(){var e=(function(n,t,r){var a=arguments.length;if(a<2)throw new D.InvalidArgument("Too few arguments");for(var i=new Array(a-1);--a;)i[a-1]=arguments[a];return r=i.pop(),[n,Ge(i),r]}).apply(this,arguments);return this._transaction.apply(this,e)},X.prototype._transaction=function(e,n,t){var r=this,a=T.trans;a&&a.db===this&&e.indexOf("!")===-1||(a=null);var i,o,u=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");try{if(o=n.map(function(f){if(f=f instanceof r.Table?f.name:f,typeof f!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return f}),e=="r"||e===mt)i=mt;else{if(e!="rw"&&e!=vt)throw new D.InvalidArgument("Invalid transaction mode: "+e);i=vt}if(a){if(a.mode===mt&&i===vt){if(!u)throw new D.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");a=null}a&&o.forEach(function(f){if(a&&a.storeNames.indexOf(f)===-1){if(!u)throw new D.SubTransaction("Table "+f+" not included in parent transaction.");a=null}}),u&&a&&!a.active&&(a=null)}}catch(f){return a?a._promise(null,function(p,s){s(f)}):G(f)}var c=(function f(p,s,m,l,h){return E.resolve().then(function(){var y=T.transless||T,d=p._createTransaction(s,m,p._dbSchema,l);if(d.explicit=!0,y={trans:d,transless:y},l)d.idbtrans=l.idbtrans;else try{d.create(),d.idbtrans._explicit=!0,p._state.PR1398_maxLoop=3}catch(b){return b.name===ot.InvalidState&&p.isOpen()&&0<--p._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),p.close({disableAutoOpen:!1}),p.open().then(function(){return f(p,s,m,null,h)})):G(b)}var v,g=qe(h);return g&&Ze(),y=E.follow(function(){var b;(v=h.call(d,d))&&(g?(b=Se.bind(null,null),v.then(b,b)):typeof v.next=="function"&&typeof v.throw=="function"&&(v=Rt(v)))},y),(v&&typeof v.then=="function"?E.resolve(v).then(function(b){return d.active?b:G(new D.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):y.then(function(){return v})).then(function(b){return l&&d._resolve(),d._completion.then(function(){return b})}).catch(function(b){return d._reject(b),G(b)})})}).bind(null,this,i,o,a,t);return a?a._promise(i,c,"lock"):T.trans?Le(T.transless,function(){return r._whenReady(c)}):this._whenReady(c)},X.prototype.table=function(e){if(!L(this._allTables,e))throw new D.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},X);function X(e,n){var t=this;this._middlewares={},this.verno=0;var r=X.dependencies;this._options=n=j({addons:X.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,cache:"cloned"},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange},r=n.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var a,i,o,u,c,f={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:W,dbReadyPromise:null,cancelOpen:W,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:n.autoOpen};f.dbReadyPromise=new E(function(s){f.dbReadyResolve=s}),f.openCanceller=new E(function(s,m){f.cancelOpen=m}),this._state=f,this.name=e,this.on=hn(this,"populate","blocked","versionchange","close",{ready:[ut,W]}),this.on.ready.subscribe=In(this.on.ready.subscribe,function(s){return function(m,l){X.vip(function(){var h,y=t._state;y.openComplete?(y.dbOpenError||E.resolve().then(m),l&&s(m)):y.onReadyBeingFired?(y.onReadyBeingFired.push(m),l&&s(m)):(s(m),h=t,l||s(function d(){h.on.ready.unsubscribe(m),h.on.ready.unsubscribe(d)}))})}}),this.Collection=(a=this,pn(Lr.prototype,function(v,d){this.db=a;var l=Jt,h=null;if(d)try{l=d()}catch(g){h=g}var y=v._ctx,d=y.table,v=d.hook.reading.fire;this._ctx={table:d,index:y.index,isPrimKey:!y.index||d.schema.primKey.keyPath&&y.index===d.schema.primKey.name,range:l,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:h,or:y.or,valueMapper:v!==sn?v:null}})),this.Table=(i=this,pn(tr.prototype,function(s,m,l){this.db=i,this._tx=l,this.name=s,this.schema=m,this.hook=i._allTables[s]?i._allTables[s].hook:hn(null,{creating:[Tr,W],reading:[Cr,sn],updating:[jr,W],deleting:[Dr,W]})})),this.Transaction=(o=this,pn(zr.prototype,function(s,m,l,h,y){var d=this;this.db=o,this.mode=s,this.storeNames=m,this.schema=l,this.chromeTransactionDurability=h,this.idbtrans=null,this.on=hn(this,"complete","error","abort"),this.parent=y||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new E(function(v,g){d._resolve=v,d._reject=g}),this._completion.then(function(){d.active=!1,d.on.complete.fire()},function(v){var g=d.active;return d.active=!1,d.on.error.fire(v),d.parent?d.parent._reject(v):g&&d.idbtrans&&d.idbtrans.abort(),G(v)})})),this.Version=(u=this,pn(Hr.prototype,function(s){this.db=u,this._cfg={version:s,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(c=this,pn(ur.prototype,function(s,m,l){if(this.db=c,this._ctx={table:s,index:m===":id"?null:m,or:l},this._cmp=this._ascending=N,this._descending=function(h,y){return N(y,h)},this._max=function(h,y){return 0<N(h,y)?h:y},this._min=function(h,y){return N(h,y)<0?h:y},this._IDBKeyRange=c._deps.IDBKeyRange,!this._IDBKeyRange)throw new D.MissingAPI})),this.on("versionchange",function(s){0<s.newVersion?console.warn("Another connection wants to upgrade database '".concat(t.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(t.name,"'. Closing db now to resume the delete request.")),t.close({disableAutoOpen:!1})}),this.on("blocked",function(s){!s.newVersion||s.newVersion<s.oldVersion?console.warn("Dexie.delete('".concat(t.name,"') was blocked")):console.warn("Upgrade '".concat(t.name,"' blocked by other connection holding version ").concat(s.oldVersion/10))}),this._maxKey=gn(n.IDBKeyRange),this._createTransaction=function(s,m,l,h){return new t.Transaction(s,m,l,t._options.chromeTransactionDurability,h)},this._fireOnBlocked=function(s){t.on("blocked").fire(s),en.filter(function(m){return m.name===t.name&&m!==t&&!m._state.vcFired}).map(function(m){return m.on("versionchange").fire(s)})},this.use(na),this.use(ia),this.use(ta),this.use(Zr),this.use(ea);var p=new Proxy(this,{get:function(s,m,l){if(m==="_vip")return!0;if(m==="table")return function(y){return Jn(t.table(y),p)};var h=Reflect.get(s,m,l);return h instanceof tr?Jn(h,p):m==="tables"?h.map(function(y){return Jn(y,p)}):m==="_createTransaction"?function(){return Jn(h.apply(this,arguments),p)}:h}});this.vip=p,r.forEach(function(s){return s(t)})}var Zn,de=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",oa=(Nt.prototype.subscribe=function(e,n,t){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:n,complete:t})},Nt.prototype[de]=function(){return this},Nt);function Nt(e){this._subscribe=e}try{Zn={indexedDB:Q.indexedDB||Q.mozIndexedDB||Q.webkitIndexedDB||Q.msIndexedDB,IDBKeyRange:Q.IDBKeyRange||Q.webkitIDBKeyRange}}catch{Zn={indexedDB:null,IDBKeyRange:null}}function xr(e){var n,t=!1,r=new oa(function(a){var i=qe(e),o,u=!1,c={},f={},p={get closed(){return u},unsubscribe:function(){u||(u=!0,o&&o.abort(),s&&Ce.storagemutated.unsubscribe(l))}};a.start&&a.start(p);var s=!1,m=function(){return yt(h)},l=function(y){Gn(c,y),Tt(f,c)&&m()},h=function(){var y,d,v;!u&&Zn.indexedDB&&(c={},y={},o&&o.abort(),o=new AbortController,v=function(g){var b=He();try{i&&Ze();var w=Ae(e,g);return w=i?w.finally(Se):w}finally{b&&Je()}}(d={subscr:y,signal:o.signal,requery:m,querier:e,trans:null}),Promise.resolve(v).then(function(g){t=!0,n=g,u||d.signal.aborted||(c={},function(b){for(var w in b)if(L(b,w))return;return 1}(f=y)||s||(Ce(vn,l),s=!0),yt(function(){return!u&&a.next&&a.next(g)}))},function(g){t=!1,["DatabaseClosedError","AbortError"].includes(g==null?void 0:g.name)||u||yt(function(){u||a.error&&a.error(g)})}))};return setTimeout(m,0),p});return r.hasValue=function(){return t},r.getValue=function(){return n},r}var We=ke;function Lt(e){var n=Te;try{Te=!0,Ce.storagemutated.fire(e),qt(e,!0)}finally{Te=n}}pe(We,j(j({},Sn),{delete:function(e){return new We(e,{addons:[]}).delete()},exists:function(e){return new We(e,{addons:[]}).open().then(function(n){return n.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return n=We.dependencies,t=n.indexedDB,n=n.IDBKeyRange,(Et(t)?Promise.resolve(t.databases()).then(function(r){return r.map(function(a){return a.name}).filter(function(a){return a!==Bn})}):St(t,n).toCollection().primaryKeys()).then(e)}catch{return G(new D.MissingAPI)}var n,t},defineClass:function(){return function(e){J(this,e)}},ignoreTransaction:function(e){return T.trans?Le(T.transless,e):e()},vip:Kt,async:function(e){return function(){try{var n=Rt(e.apply(this,arguments));return n&&typeof n.then=="function"?n:E.resolve(n)}catch(t){return G(t)}}},spawn:function(e,n,t){try{var r=Rt(e.apply(t,n||[]));return r&&typeof r.then=="function"?r:E.resolve(r)}catch(a){return G(a)}},currentTransaction:{get:function(){return T.trans||null}},waitFor:function(e,n){return n=E.resolve(typeof e=="function"?We.ignoreTransaction(e):e).timeout(n||6e4),T.trans?T.trans.waitFor(n):n},Promise:E,debug:{get:function(){return ge},set:function(e){Wt(e)}},derive:me,extend:J,props:pe,override:In,Events:hn,on:Ce,liveQuery:xr,extendObservabilitySet:Gn,getByKeyPath:fe,setByKeyPath:ue,delByKeyPath:function(e,n){typeof n=="string"?ue(e,n,void 0):"length"in n&&[].map.call(n,function(t){ue(e,t,void 0)})},shallowClone:Pn,deepClone:_e,getObjectDiff:Bt,cmp:N,asap:Qe,minKey:-1/0,addons:[],connections:en,errnames:ot,dependencies:Zn,cache:ze,semVer:"4.0.11",version:"4.0.11".split(".").map(function(e){return parseInt(e)}).reduce(function(e,n,t){return e+n/Math.pow(10,2*t)})})),We.maxKey=gn(We.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Ce(vn,function(e){Te||(e=new CustomEvent(_t,{detail:e}),Te=!0,dispatchEvent(e),Te=!1)}),addEventListener(_t,function(e){e=e.detail,Te||Lt(e)}));var rn,Te=!1,kr=function(){};return typeof BroadcastChannel<"u"&&((kr=function(){(rn=new BroadcastChannel(_t)).onmessage=function(e){return e.data&&Lt(e.data)}})(),typeof rn.unref=="function"&&rn.unref(),Ce(vn,function(e){Te||rn.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!ke.disableBfCache&&e.persisted){ge&&console.debug("Dexie: handling persisted pagehide"),rn!=null&&rn.close();for(var n=0,t=en;n<t.length;n++)t[n].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!ke.disableBfCache&&e.persisted&&(ge&&console.debug("Dexie: handling persisted pageshow"),kr(),Lt({all:new te(-1/0,[[]])}))})),E.rejectionMapper=function(e,n){return!e||e instanceof Pe||e instanceof TypeError||e instanceof SyntaxError||!e.name||!zt[e.name]?e:(n=new zt[e.name](n||e.message,e),"stack"in e&&ye(n,"stack",{get:function(){return this.inner.stack}}),n)},Wt(ge),j(ke,Object.freeze({__proto__:null,Dexie:ke,liveQuery:xr,Entity:Zt,cmp:N,PropModification:yn,replacePrefix:function(e,n){return new yn({replacePrefix:[e,n]})},add:function(e){return new yn({add:e})},remove:function(e){return new yn({remove:e})},default:ke,RangeSet:te,mergeRanges:_n,rangesOverlap:dr}),{default:ke}),ke})})(Er);var fa=Er.exports;const Ut=ua(fa),Ar=Symbol.for("Dexie"),nt=globalThis[Ar]||(globalThis[Ar]=Ut);if(Ut.semVer!==nt.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Ut.semVer} and ${nt.semVer}`);const{liveQuery:ya,mergeRanges:ma,rangesOverlap:va,RangeSet:ga,cmp:ba,Entity:wa,PropModification:_a,replacePrefix:xa,add:ka,remove:Ia}=nt,Pa=ie.object({id:ie.string(),name:ie.string(),sourceSchema:ie.string().optional(),sourceTableId:ie.string(),targetSchema:ie.string().optional(),targetTableId:ie.string(),sourceFieldId:ie.string(),targetFieldId:ie.string(),sourceCardinality:ie.union([ie.literal("one"),ie.literal("many")]),targetCardinality:ie.union([ie.literal("one"),ie.literal("many")]),createdAt:ie.number()}),Oa=(H,C)=>!C||!H.sourceSchema||!H.targetSchema||C.includes(Or(H.sourceSchema))&&C.includes(Or(H.targetSchema)),Sr=(H,C)=>H.unique||H.primaryKey&&!C?"one":"many",Aa=({foreignKeys:H,tables:C})=>H.map(ne=>{const j=Pr(ne.schema),oe=C.find(L=>L.name===ne.table&&L.schema===j),Q=Pr(ne.reference_schema),U=C.find(L=>L.name===ne.reference_table&&L.schema===Q),z=oe==null?void 0:oe.fields.find(L=>L.name===ne.column),J=U==null?void 0:U.fields.find(L=>L.name===ne.reference_column),he=((oe==null?void 0:oe.fields.filter(L=>L.primaryKey))??[]).length>1,an=((U==null?void 0:U.fields.filter(L=>L.primaryKey))??[]).length>1;if(oe&&U&&z&&J){const L=Sr(z,he),pe=Sr(J,an);return{id:sa(),name:ne.foreign_key_name,sourceSchema:j,targetSchema:Q,sourceTableId:oe.id,targetTableId:U.id,sourceFieldId:z.id,targetFieldId:J.id,sourceCardinality:L,targetCardinality:pe,createdAt:Date.now()}}return null}).filter(ne=>ne!==null),Sa=({sourceCardinality:H,targetCardinality:C})=>H==="one"&&C==="one"?"one_to_one":H==="one"&&C==="many"?"one_to_many":H==="many"&&C==="one"?"many_to_one":"many_to_many",da=H=>{switch(H){case"one_to_one":return{sourceCardinality:"one",targetCardinality:"one"};case"one_to_many":return{sourceCardinality:"one",targetCardinality:"many"};case"many_to_one":return{sourceCardinality:"many",targetCardinality:"one"};case"many_to_many":return{sourceCardinality:"many",targetCardinality:"many"}}},Ea=({children:H})=>{const C=new nt("ChartDB");C.version(1).stores({diagrams:"++id, name, databaseType, createdAt, updatedAt",db_tables:"++id, diagramId, name, x, y, fields, indexes, color, createdAt, width",db_relationships:"++id, diagramId, name, sourceTableId, targetTableId, sourceFieldId, targetFieldId, type, createdAt",config:"++id, defaultDiagramId"}),C.version(2).upgrade(_=>_.table("db_tables").toCollection().modify(P=>{for(const q of P.fields)q.type={id:q.type.split(" ").join("_"),name:q.type}})),C.version(3).stores({diagrams:"++id, name, databaseType, databaseEdition, createdAt, updatedAt",db_tables:"++id, diagramId, name, x, y, fields, indexes, color, createdAt, width",db_relationships:"++id, diagramId, name, sourceTableId, targetTableId, sourceFieldId, targetFieldId, type, createdAt",config:"++id, defaultDiagramId"}),C.version(4).stores({diagrams:"++id, name, databaseType, databaseEdition, createdAt, updatedAt",db_tables:"++id, diagramId, name, x, y, fields, indexes, color, createdAt, width, comment",db_relationships:"++id, diagramId, name, sourceTableId, targetTableId, sourceFieldId, targetFieldId, type, createdAt",config:"++id, defaultDiagramId"}),C.version(5).stores({diagrams:"++id, name, databaseType, databaseEdition, createdAt, updatedAt",db_tables:"++id, diagramId, name, schema, x, y, fields, indexes, color, createdAt, width, comment",db_relationships:"++id, diagramId, name, sourceSchema, sourceTableId, targetSchema, targetTableId, sourceFieldId, targetFieldId, type, createdAt",config:"++id, defaultDiagramId"}),C.version(6).upgrade(_=>_.table("db_relationships").toCollection().modify((P,q)=>{const{sourceCardinality:qe,targetCardinality:un}=da(P.type??"one_to_one");P.sourceCardinality=qe,P.targetCardinality=un,delete q.value.type})),C.version(7).stores({diagrams:"++id, name, databaseType, databaseEdition, createdAt, updatedAt",db_tables:"++id, diagramId, name, schema, x, y, fields, indexes, color, createdAt, width, comment",db_relationships:"++id, diagramId, name, sourceSchema, sourceTableId, targetSchema, targetTableId, sourceFieldId, targetFieldId, type, createdAt",db_dependencies:"++id, diagramId, schema, tableId, dependentSchema, dependentTableId, createdAt",config:"++id, defaultDiagramId"}),C.version(8).stores({diagrams:"++id, name, databaseType, databaseEdition, createdAt, updatedAt",db_tables:"++id, diagramId, name, schema, x, y, fields, indexes, color, createdAt, width, comment, isView, isMaterializedView, order",db_relationships:"++id, diagramId, name, sourceSchema, sourceTableId, targetSchema, targetTableId, sourceFieldId, targetFieldId, type, createdAt",db_dependencies:"++id, diagramId, schema, tableId, dependentSchema, dependentTableId, createdAt",config:"++id, defaultDiagramId"}),C.version(9).upgrade(_=>_.table("db_tables").toCollection().modify(P=>{for(const q of P.fields)typeof q.nullable=="string"&&(q.nullable=q.nullable.toLowerCase()==="true")})),C.version(10).stores({diagrams:"++id, name, databaseType, databaseEdition, createdAt, updatedAt",db_tables:"++id, diagramId, name, schema, x, y, fields, indexes, color, createdAt, width, comment, isView, isMaterializedView, order",db_relationships:"++id, diagramId, name, sourceSchema, sourceTableId, targetSchema, targetTableId, sourceFieldId, targetFieldId, type, createdAt",db_dependencies:"++id, diagramId, schema, tableId, dependentSchema, dependentTableId, createdAt",areas:"++id, diagramId, name, x, y, width, height, color",config:"++id, defaultDiagramId"}),C.on("ready",async()=>{var P;if(!await ne()){const q=await C.diagrams.toArray();await C.config.add({id:1,defaultDiagramId:((P=q==null?void 0:q[0])==null?void 0:P.id)??""})}});const ne=async()=>await C.config.get(1),j=async _=>{await C.config.update(1,_)},oe=async({diagram:_})=>{const P=[];P.push(C.diagrams.add({id:_.id,name:_.name,databaseType:_.databaseType,databaseEdition:_.databaseEdition,createdAt:_.createdAt,updatedAt:_.updatedAt}));const q=_.tables??[];P.push(...q.map(ve=>he({diagramId:_.id,table:ve})));const qe=_.relationships??[];P.push(...qe.map(ve=>kn({diagramId:_.id,relationship:ve})));const un=_.dependencies??[];P.push(...un.map(ve=>fe({diagramId:_.id,dependency:ve})));const Pe=_.areas??[];P.push(...Pe.map(ve=>Ie({diagramId:_.id,area:ve}))),await Promise.all(P)},Q=async(_={includeRelationships:!1,includeTables:!1,includeDependencies:!1,includeAreas:!1})=>{let P=await C.diagrams.toArray();return _.includeTables&&(P=await Promise.all(P.map(async q=>(q.tables=await me(q.id),q)))),_.includeRelationships&&(P=await Promise.all(P.map(async q=>(q.relationships=await Qe(q.id),q)))),_.includeDependencies&&(P=await Promise.all(P.map(async q=>(q.dependencies=await Ge(q.id),q)))),_.includeAreas&&(P=await Promise.all(P.map(async q=>(q.areas=await je(q.id),q)))),P},U=async(_,P={includeRelationships:!1,includeTables:!1,includeDependencies:!1,includeAreas:!1})=>{const q=await C.diagrams.get(_);if(q)return P.includeTables&&(q.tables=await me(_)),P.includeRelationships&&(q.relationships=await Qe(_)),P.includeDependencies&&(q.dependencies=await Ge(_)),P.includeAreas&&(q.areas=await je(_)),q},z=async({id:_,attributes:P})=>{await C.diagrams.update(_,P),P.id&&await Promise.all([C.db_tables.where("diagramId").equals(_).modify({diagramId:P.id}),C.db_relationships.where("diagramId").equals(_).modify({diagramId:P.id}),C.db_dependencies.where("diagramId").equals(_).modify({diagramId:P.id})])},J=async _=>{await Promise.all([C.diagrams.delete(_),C.db_tables.where("diagramId").equals(_).delete(),C.db_relationships.where("diagramId").equals(_).delete(),C.db_dependencies.where("diagramId").equals(_).delete(),C.areas.where("diagramId").equals(_).delete()])},he=async({diagramId:_,table:P})=>{await C.db_tables.add({...P,diagramId:_})},an=async({id:_,diagramId:P})=>await C.db_tables.get({id:_,diagramId:P}),L=async _=>{await C.db_tables.where("diagramId").equals(_).delete()},pe=async({id:_,attributes:P})=>{await C.db_tables.update(_,P)},xn=async({diagramId:_,table:P})=>{await C.db_tables.put({...P,diagramId:_})},ye=async({id:_,diagramId:P})=>{await C.db_tables.where({id:_,diagramId:P}).delete()},me=async _=>await C.db_tables.where("diagramId").equals(_).toArray(),kn=async({diagramId:_,relationship:P})=>{await C.db_relationships.add({...P,diagramId:_})},tt=async _=>{await C.db_relationships.where("diagramId").equals(_).delete()},$e=async({id:_,diagramId:P})=>await C.db_relationships.get({id:_,diagramId:P}),In=async({id:_,attributes:P})=>{await C.db_relationships.update(_,P)},De=async({id:_,diagramId:P})=>{await C.db_relationships.where({id:_,diagramId:P}).delete()},Qe=async _=>(await C.db_relationships.where("diagramId").equals(_).toArray()).sort((P,q)=>P.name.localeCompare(q.name)),fe=async({diagramId:_,dependency:P})=>{await C.db_dependencies.add({...P,diagramId:_})},ue=async({diagramId:_,id:P})=>await C.db_dependencies.get({id:P,diagramId:_}),Pn=async({id:_,attributes:P})=>{await C.db_dependencies.update(_,P)},rt=async({diagramId:_,id:P})=>{await C.db_dependencies.where({id:P,diagramId:_}).delete()},Ge=async _=>await C.db_dependencies.where("diagramId").equals(_).toArray(),On=async _=>{await C.db_dependencies.where("diagramId").equals(_).delete()},Ie=async({area:_,diagramId:P})=>{await C.areas.add({..._,diagramId:P})},_e=async({diagramId:_,id:P})=>await C.areas.get({id:P,diagramId:_}),at=async({id:_,attributes:P})=>{await C.areas.update(_,P)},on=async({diagramId:_,id:P})=>{await C.areas.where({id:P,diagramId:_}).delete()},je=async _=>await C.areas.where("diagramId").equals(_).toArray(),it=async _=>{await C.areas.where("diagramId").equals(_).delete()};return ca.jsx(la.Provider,{value:{getConfig:ne,updateConfig:j,addDiagram:oe,listDiagrams:Q,getDiagram:U,updateDiagram:z,deleteDiagram:J,addTable:he,getTable:an,updateTable:pe,putTable:xn,deleteTable:ye,listTables:me,addRelationship:kn,getRelationship:$e,updateRelationship:In,deleteRelationship:De,listRelationships:Qe,deleteDiagramTables:L,deleteDiagramRelationships:tt,addDependency:fe,getDependency:ue,updateDependency:Pn,deleteDependency:rt,listDependencies:Ge,deleteDiagramDependencies:On,addArea:Ie,getArea:_e,updateArea:at,deleteArea:on,listAreas:je,deleteDiagramAreas:it},children:H})};export{Ea as S,da as a,Pa as b,Aa as c,Sa as d,Oa as s};
